"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e(require("jquery")):e(window.jQuery)}(function(V){var K,h;V.fn.fileinputLocales={},V.fn.fileinputThemes={},String.prototype.setTokens=function(e){var t,i,a=this.toString();for(t in e)e.hasOwnProperty(t)&&(i=new RegExp("{"+t+"}","g"),a=a.replace(i,e[t]));return a},K={FRAMES:".kv-preview-thumb",SORT_CSS:"file-sortable",OBJECT_PARAMS:'<param name="controller" value="true" />\n<param name="allowFullScreen" value="true" />\n<param name="allowScriptAccess" value="always" />\n<param name="autoPlay" value="false" />\n<param name="autoStart" value="false" />\n<param name="quality" value="high" />\n',DEFAULT_PREVIEW:'<div class="file-preview-other">\n<span class="{previewFileIconClass}">{previewFileIcon}</span>\n</div>',MODAL_ID:"kvFileinputModal",MODAL_EVENTS:["show","shown","hide","hidden","loaded"],objUrl:window.URL||window.webkitURL,compare:function(e,t,i){return void 0!==e&&(i?e===t:e.match(t))},isIE:function(e){if("Microsoft Internet Explorer"!==navigator.appName)return!1;if(10===e)return new RegExp("msie\\s"+e,"i").test(navigator.userAgent);var t,i=document.createElement("div");return i.innerHTML="\x3c!--[if IE "+e+"]> <i></i> <![endif]--\x3e",t=i.getElementsByTagName("i").length,document.body.appendChild(i),i.parentNode.removeChild(i),t},canAssignFilesToInput:function(){var e=document.createElement("input");try{return e.type="file",!(e.files=null)}catch(e){return!1}},getDragDropFolders:function(e){var t,i,a=e.length,r=0;if(0<a&&e[0].webkitGetAsEntry())for(t=0;t<a;t++)(i=e[t].webkitGetAsEntry())&&i.isDirectory&&r++;return r},initModal:function(e){var t=V("body");t.length&&e.appendTo(t)},isEmpty:function(e,t){return null==e||0===e.length||t&&""===V.trim(e)},isArray:function(e){return Array.isArray(e)||"[object Array]"===Object.prototype.toString.call(e)},ifSet:function(e,t,i){return i=i||"",t&&"object"==_typeof(t)&&e in t?t[e]:i},cleanArray:function(e){return e instanceof Array||(e=[]),e.filter(function(e){return null!=e})},spliceArray:function(e,t,i){var a,r,n=0,o=[];if(!(e instanceof Array))return[];for(r=V.extend(!0,[],e),i&&r.reverse(),a=0;a<r.length;a++)a!==t&&(o[n]=r[a],n++);return i&&o.reverse(),o},getNum:function(e,t){return t=t||0,"number"==typeof e?e:("string"==typeof e&&(e=parseFloat(e)),isNaN(e)?t:e)},hasFileAPISupport:function(){return!(!window.File||!window.FileReader)},hasDragDropSupport:function(){var e=document.createElement("div");return!K.isIE(9)&&(void 0!==e.draggable||void 0!==e.ondragstart&&void 0!==e.ondrop)},hasFileUploadSupport:function(){return K.hasFileAPISupport()&&window.FormData},hasBlobSupport:function(){try{return!!window.Blob&&Boolean(new Blob)}catch(e){return!1}},hasArrayBufferViewSupport:function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}},dataURI2Blob:function(e){var t,i,a,r,n,o,s=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,l=K.hasBlobSupport();if(!((l||s)&&window.atob&&window.ArrayBuffer&&window.Uint8Array))return null;for(t=0<=e.split(",")[0].indexOf("base64")?atob(e.split(",")[1]):decodeURIComponent(e.split(",")[1]),i=new ArrayBuffer(t.length),a=new Uint8Array(i),r=0;r<t.length;r+=1)a[r]=t.charCodeAt(r);return n=e.split(",")[0].split(":")[1].split(";")[0],l?new Blob([K.hasArrayBufferViewSupport()?a:i],{type:n}):((o=new s).append(i),o.getBlob(n))},arrayBuffer2String:function(e){if(window.TextDecoder)return new TextDecoder("utf-8").decode(e);var t,i,a,r,n=Array.prototype.slice.apply(new Uint8Array(e)),o="",s=0;for(t=n.length;s<t;)switch((i=n[s++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:a=n[s++],o+=String.fromCharCode((31&i)<<6|63&a);break;case 14:a=n[s++],r=n[s++],o+=String.fromCharCode((15&i)<<12|(63&a)<<6|(63&r)<<0)}return o},isHtml:function(e){var t=document.createElement("div");t.innerHTML=e;for(var i=t.childNodes,a=i.length;a--;)if(1===i[a].nodeType)return!0;return!1},isSvg:function(e){return e.match(/^\s*<\?xml/i)&&(e.match(/<!DOCTYPE svg/i)||e.match(/<svg/i))},getMimeType:function(e,t,i){switch(e){case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":return"image/jpeg";case"89504E47":return"image/png";case"47494638":return"image/gif";case"49492a00":return"image/tiff";case"52494646":return"image/webp";case"66747970":return"video/3gp";case"4f676753":return"video/ogg";case"1a45dfa3":return"video/mkv";case"000001ba":case"000001b3":return"video/mpeg";case"3026b275":return"video/wmv";case"25504446":return"application/pdf";case"25215053":return"application/ps";case"504b0304":case"504b0506":case"504b0508":return"application/zip";case"377abcaf":return"application/7z";case"75737461":return"application/tar";case"7801730d":return"application/dmg";default:switch(e.substring(0,6)){case"435753":return"application/x-shockwave-flash";case"494433":return"audio/mp3";case"425a68":return"application/bzip";default:switch(e.substring(0,4)){case"424d":return"image/bmp";case"fffb":return"audio/mp3";case"4d5a":return"application/exe";case"1f9d":case"1fa0":return"application/zip";case"1f8b":return"application/gzip";default:return t&&!t.match(/[^\u0000-\u007f]/)?"application/text-plain":i}}}},addCss:function(e,t){e.removeClass(t).addClass(t)},getElement:function(e,t,i){return K.isEmpty(e)||K.isEmpty(e[t])?i:V(e[t])},uniqId:function(){return Math.round((new Date).getTime())+"_"+Math.round(100*Math.random())},htmlEncode:function(e,t){return void 0===e?t||null:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},replaceTags:function(e,t){var i=e;return t&&V.each(t,function(e,t){"function"==typeof t&&(t=t()),i=i.split(e).join(t)}),i},cleanMemory:function(e){var t=e.is("img")?e.attr("src"):e.find("source").attr("src");K.objUrl.revokeObjectURL(t)},findFileName:function(e){var t=e.lastIndexOf("/");return-1===t&&(t=e.lastIndexOf("\\")),e.split(e.substring(t,t+1)).pop()},checkFullScreen:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},toggleFullScreen:function(e){var t=document,i=t.documentElement;i&&e&&!K.checkFullScreen()?i.requestFullscreen?i.requestFullscreen():i.msRequestFullscreen?i.msRequestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):t.exitFullscreen?t.exitFullscreen():t.msExitFullscreen?t.msExitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen&&t.webkitExitFullscreen()},moveArray:function(e,t,i,a){var r=V.extend(!0,[],e);if(a&&r.reverse(),i>=r.length)for(var n=i-r.length;1+n--;)r.push(void 0);return r.splice(i,0,r.splice(t,1)[0]),a&&r.reverse(),r},cleanZoomCache:function(e){var t=e.closest(".kv-zoom-cache-theme");t.length||(t=e.closest(".kv-zoom-cache")),t.remove()},closeButton:function(e){return'<button type="button" class="'+(e=e?"close "+e:"close")+'" aria-label="Close">\n  <span aria-hidden="true">&times;</span>\n</button>'},getRotation:function(e){switch(e){case 2:return"rotateY(180deg)";case 3:return"rotate(180deg)";case 4:return"rotate(180deg) rotateY(180deg)";case 5:return"rotate(270deg) rotateY(180deg)";case 6:return"rotate(90deg)";case 7:return"rotate(90deg) rotateY(180deg)";case 8:return"rotate(270deg)";default:return""}},setTransform:function(e,t){e&&(e.style.transform=t,e.style.webkitTransform=t,e.style["-moz-transform"]=t,e.style["-ms-transform"]=t,e.style["-o-transform"]=t)},setImageOrientation:function(d,c,h){if(d&&d.length){var e="load.fileinputimageorient";d.off(e).on(e,function(){var e=d.get(0),t=c&&c.length?c.get(0):null,i=e.offsetHeight,a=e.offsetWidth,r=K.getRotation(h);if(d.data("orientation",h),t&&c.data("orientation",h),h<5)return K.setTransform(e,r),void K.setTransform(t,r);var n=Math.atan(a/i),o=Math.sqrt(Math.pow(i,2)+Math.pow(a,2)),s=o?i/Math.cos(Math.PI/2+n)/o:1,l=" scale("+Math.abs(s)+")";K.setTransform(e,r+l),K.setTransform(t,r+l)})}}},(h=function(e,t){this.$element=V(e),this.$parent=this.$element.parent(),this._validate()&&(this.isPreviewable=K.hasFileAPISupport(),this.isIE9=K.isIE(9),this.isIE10=K.isIE(10),(this.isPreviewable||this.isIE9)&&(this._init(t),this._listen()),this.$element.removeClass("file-loading"))}).prototype={constructor:h,_cleanup:function(){this.reader=null,this.formdata={},this.uploadCount=0,this.uploadStatus={},this.uploadLog=[],this.uploadAsyncCount=0,this.loadedImages=[],this.totalImagesCount=0,this.ajaxRequests=[],this.clearStack(),this.fileBatchCompleted=!0,this.isPreviewable||(this.showPreview=!1),this.isError=!1,this.ajaxAborted=!1,this.cancelling=!1},_init:function(e,t){var i,a,r,n,o=this,s=o.$element;o.options=e,V.each(e,function(e,t){switch(e){case"minFileCount":case"maxFileCount":case"minFileSize":case"maxFileSize":case"maxFilePreviewSize":case"resizeImageQuality":case"resizeIfSizeMoreThan":case"progressUploadThreshold":case"initialPreviewCount":case"zoomModalHeight":case"minImageHeight":case"maxImageHeight":case"minImageWidth":case"maxImageWidth":o[e]=K.getNum(t);break;default:o[e]=t}}),o.rtl&&(n=o.previewZoomButtonIcons.prev,o.previewZoomButtonIcons.prev=o.previewZoomButtonIcons.next,o.previewZoomButtonIcons.next=n),t||o._cleanup(),o.$form=s.closest("form"),o._initTemplateDefaults(),o.uploadFileAttr=K.isEmpty(s.attr("name"))?"file_data":s.attr("name"),r=o._getLayoutTemplate("progress"),o.progressTemplate=r.replace("{class}",o.progressClass),o.progressCompleteTemplate=r.replace("{class}",o.progressCompleteClass),o.progressErrorTemplate=r.replace("{class}",o.progressErrorClass),o.isDisabled=s.attr("disabled")||s.attr("readonly"),o.isDisabled&&s.attr("disabled",!0),o.isAjaxUpload=K.hasFileUploadSupport()&&!K.isEmpty(o.uploadUrl),o.dropZoneEnabled=K.hasDragDropSupport()&&o.dropZoneEnabled,o.isAjaxUpload||(o.dropZoneEnabled=o.dropZoneEnabled&&K.canAssignFilesToInput()),o.isClickable=o.browseOnZoneClick&&o.showPreview&&(o.dropZoneEnabled||!K.isEmpty(o.defaultPreviewContent)),o.slug="function"==typeof e.slugCallback?e.slugCallback:o._slugDefault,o.mainTemplate=o.showCaption?o._getLayoutTemplate("main1"):o._getLayoutTemplate("main2"),o.captionTemplate=o._getLayoutTemplate("caption"),o.previewGenericTemplate=o._getPreviewTemplate("generic"),!o.imageCanvas&&o.resizeImage&&(o.maxImageWidth||o.maxImageHeight)&&(o.imageCanvas=document.createElement("canvas"),o.imageCanvasContext=o.imageCanvas.getContext("2d")),K.isEmpty(s.attr("id"))&&s.attr("id",K.uniqId()),o.namespace=".fileinput_"+s.attr("id").replace(/-/g,"_"),void 0===o.$container?o.$container=o._createContainer():o._refreshContainer(),a=o.$container,o.$dropZone=a.find(".file-drop-zone"),o.$progress=a.find(".kv-upload-progress"),o.$btnUpload=a.find(".fileinput-upload"),o.$captionContainer=K.getElement(e,"elCaptionContainer",a.find(".file-caption")),o.$caption=K.getElement(e,"elCaptionText",a.find(".file-caption-name")),K.isEmpty(o.msgPlaceholder)||(i=s.attr("multiple")?o.filePlural:o.fileSingle,o.$caption.attr("placeholder",o.msgPlaceholder.replace("{files}",i))),o.$captionIcon=o.$captionContainer.find(".file-caption-icon"),o.$previewContainer=K.getElement(e,"elPreviewContainer",a.find(".file-preview")),o.$preview=K.getElement(e,"elPreviewImage",a.find(".file-preview-thumbnails")),o.$previewStatus=K.getElement(e,"elPreviewStatus",a.find(".file-preview-status")),o.$errorContainer=K.getElement(e,"elErrorContainer",o.$previewContainer.find(".kv-fileinput-error")),o._validateDisabled(),K.isEmpty(o.msgErrorClass)||K.addCss(o.$errorContainer,o.msgErrorClass),t?o._errorsExist()||o.$errorContainer.hide():(o.$errorContainer.hide(),o.previewInitId="preview-"+K.uniqId(),o._initPreviewCache(),o._initPreview(!0),o._initPreviewActions(),o.$parent.hasClass("file-loading")&&(o.$container.insertBefore(o.$parent),o.$parent.remove())),o._setFileDropZoneTitle(),s.attr("disabled")&&o.disable(),o._initZoom(),o.hideThumbnailContent&&K.addCss(o.$preview,"hide-content")},_initTemplateDefaults:function(){var e,t,i,a,r,n,o,s,l=this;e=K.closeButton("fileinput-remove"),t='<div id="'+K.MODAL_ID+'" class="file-zoom-dialog modal fade" tabindex="-1" aria-labelledby="'+K.MODAL_ID+'Label"></div>',i='<video class="kv-preview-data file-preview-video" controls {style}>\n<source src="{data}" type="{type}">\n'+K.DEFAULT_PREVIEW+"\n</video>\n",a='\x3c!--suppress ALL --\x3e<audio class="kv-preview-data file-preview-audio" controls {style}>\n<source src="{data}" type="{type}">\n'+K.DEFAULT_PREVIEW+"\n</audio>\n",n='<embed class="kv-preview-data file-preview-pdf" src="{data}" type="application/pdf" {style}>\n',r='<object class="kv-preview-data file-preview-object file-object {typeCss}" data="{data}" type="{type}" {style}>\n<param name="movie" value="{caption}" />\n'+K.OBJECT_PARAMS+" "+K.DEFAULT_PREVIEW+"\n</object>\n",o='<div class="kv-preview-data file-preview-other-frame" {style}>\n'+K.DEFAULT_PREVIEW+"\n</div>\n",s={width:"100%",height:"100%","min-height":"480px"},l._isPdfRendered()&&(n=l.pdfRendererTemplate.replace("{renderer}",l.pdfRendererUrl)),l.defaults={layoutTemplates:{main1:'{preview}\n<div class="kv-upload-progress kv-hidden"></div><div class="clearfix"></div>\n<div class="input-group {class}">\n  {caption}\n<div class="input-group-btn input-group-append">\n      {remove}\n      {cancel}\n      {upload}\n      {browse}\n    </div>\n</div>',main2:'{preview}\n<div class="kv-upload-progress kv-hidden"></div>\n<div class="clearfix"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',preview:'<div class="file-preview {class}">\n    {close}    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',close:e,fileIcon:'<i class="glyphicon glyphicon-file"></i>',caption:'<div class="file-caption form-control {class}" tabindex="500">\n  <span class="file-caption-icon"></span>\n  <input class="file-caption-name" onkeydown="return false;" onpaste="return false;">\n</div>',modalMain:t,modal:'<div class="modal-dialog modal-lg{rtl}" role="document">\n  <div class="modal-content">\n    <div class="modal-header">\n      <h5 class="modal-title">{heading}</h5>\n      <span class="kv-zoom-title"></span>\n      <div class="kv-zoom-actions">{toggleheader}{fullscreen}{borderless}{close}</div>\n    </div>\n    <div class="modal-body">\n      <div class="floating-buttons"></div>\n      <div class="kv-zoom-body file-zoom-content {zoomFrameClass}"></div>\n{prev} {next}\n    </div>\n  </div>\n</div>\n',progress:'<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {status}\n     </div>\n</div>',size:" <samp>({sizeText})</samp>",footer:'<div class="file-thumbnail-footer">\n    <div class="file-footer-caption" title="{caption}">\n        <div class="file-caption-info">{caption}</div>\n        <div class="file-size-info">{size}</div>\n    </div>\n    {progress}\n{indicator}\n{actions}\n</div>',indicator:'<div class="file-upload-indicator" title="{indicatorTitle}">{indicator}</div>',actions:'<div class="file-actions">\n    <div class="file-footer-buttons">\n        {download} {upload} {delete} {zoom} {other}    </div>\n</div>\n{drag}\n<div class="clearfix"></div>',actionDelete:'<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}" {dataUrl}{dataKey}>{removeIcon}</button>\n',actionUpload:'<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">{uploadIcon}</button>',actionDownload:'<a class="kv-file-download {downloadClass}" title="{downloadTitle}" href="{downloadUrl}" download="{caption}" target="_blank">{downloadIcon}</a>',actionZoom:'<button type="button" class="kv-file-zoom {zoomClass}" title="{zoomTitle}">{zoomIcon}</button>',actionDrag:'<span class="file-drag-handle {dragClass}" title="{dragTitle}">{dragIcon}</span>',btnDefault:'<button type="{type}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</button>',btnLink:'<a href="{href}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</a>',btnBrowse:'<div tabindex="500" class="{css}" {status}>{icon} {label}</div>',zoomCache:'<div class="kv-zoom-cache" style="display:none">{zoomContent}</div>'},previewMarkupTags:{tagBefore1:'<div class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}"><div class="kv-file-content">\n',tagBefore2:'<div class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}" title="{caption}"><div class="kv-file-content">\n',tagAfter:"</div>{footer}\n</div>\n"},previewContentTemplates:{generic:"{content}\n",html:'<div class="kv-preview-data file-preview-html" title="{caption}" {style}>{data}</div>\n',image:'<img src="{data}" class="file-preview-image kv-preview-data" title="{caption}" alt="{caption}" {style}>\n',text:'<textarea class="kv-preview-data file-preview-text" title="{caption}" readonly {style}>{data}</textarea>\n',office:'<iframe class="kv-preview-data file-preview-office" src="https://view.officeapps.live.com/op/embed.aspx?src={data}" {style}></iframe>',gdocs:'<iframe class="kv-preview-data file-preview-gdocs" src="https://docs.google.com/gview?url={data}&embedded=true" {style}></iframe>',video:i,audio:a,flash:'<embed class="kv-preview-data file-preview-flash" src="{data}" type="application/x-shockwave-flash" {style}>\n',object:r,pdf:n,other:o},allowedPreviewTypes:["image","html","text","video","audio","flash","pdf","object"],previewTemplates:{},previewSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"213px",height:"160px"},text:{width:"213px",height:"160px"},office:{width:"213px",height:"160px"},gdocs:{width:"213px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"100%",height:"30px"},flash:{width:"213px",height:"160px"},object:{width:"213px",height:"160px"},pdf:{width:"100%",height:"160px"},other:{width:"213px",height:"160px"}},previewSettingsSmall:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"100%",height:"160px"},text:{width:"100%",height:"160px"},office:{width:"100%",height:"160px"},gdocs:{width:"100%",height:"160px"},video:{width:"100%",height:"auto"},audio:{width:"100%",height:"30px"},flash:{width:"100%",height:"auto"},object:{width:"100%",height:"auto"},pdf:{width:"100%",height:"160px"},other:{width:"100%",height:"160px"}},previewZoomSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:s,text:s,office:{width:"100%",height:"100%","max-width":"100%","min-height":"480px"},gdocs:{width:"100%",height:"100%","max-width":"100%","min-height":"480px"},video:{width:"auto",height:"100%","max-width":"100%"},audio:{width:"100%",height:"30px"},flash:{width:"auto",height:"480px"},object:{width:"auto",height:"100%","max-width":"100%","min-height":"480px"},pdf:s,other:{width:"auto",height:"100%","min-height":"480px"}},fileTypeSettings:{image:function(e,t){return K.compare(e,"image.*")&&!K.compare(e,/(tiff?|wmf)$/i)||K.compare(t,/\.(gif|png|jpe?g)$/i)},html:function(e,t){return K.compare(e,"text/html")||K.compare(t,/\.(htm|html)$/i)},office:function(e,t){return K.compare(e,/(word|excel|powerpoint|office)$/i)||K.compare(t,/\.(docx?|xlsx?|pptx?|pps|potx?)$/i)},gdocs:function(e,t){return K.compare(e,/(word|excel|powerpoint|office|iwork-pages|tiff?)$/i)||K.compare(t,/\.(docx?|xlsx?|pptx?|pps|potx?|rtf|ods|odt|pages|ai|dxf|ttf|tiff?|wmf|e?ps)$/i)},text:function(e,t){return K.compare(e,"text.*")||K.compare(t,/\.(xml|javascript)$/i)||K.compare(t,/\.(txt|md|csv|nfo|ini|json|php|js|css)$/i)},video:function(e,t){return K.compare(e,"video.*")&&(K.compare(e,/(ogg|mp4|mp?g|mov|webm|3gp)$/i)||K.compare(t,/\.(og?|mp4|webm|mp?g|mov|3gp)$/i))},audio:function(e,t){return K.compare(e,"audio.*")&&(K.compare(t,/(ogg|mp3|mp?g|wav)$/i)||K.compare(t,/\.(og?|mp3|mp?g|wav)$/i))},flash:function(e,t){return K.compare(e,"application/x-shockwave-flash",!0)||K.compare(t,/\.(swf)$/i)},pdf:function(e,t){return K.compare(e,"application/pdf",!0)||K.compare(t,/\.(pdf)$/i)},object:function(){return!0},other:function(){return!0}},fileActionSettings:{showRemove:!0,showUpload:!0,showDownload:!0,showZoom:!0,showDrag:!0,removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",removeErrorClass:"btn btn-sm btn-kv btn-danger",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",uploadTitle:"Upload file",uploadRetryIcon:'<i class="glyphicon glyphicon-repeat"></i>',uploadRetryTitle:"Retry upload",downloadIcon:'<i class="glyphicon glyphicon-download"></i>',downloadClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",downloadTitle:"Download file",zoomIcon:'<i class="glyphicon glyphicon-zoom-in"></i>',zoomClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",zoomTitle:"View Details",dragIcon:'<i class="glyphicon glyphicon-move"></i>',dragClass:"text-info",dragTitle:"Move / Rearrange",dragSettings:{},indicatorNew:'<i class="glyphicon glyphicon-plus-sign text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hourglass text-muted"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."}},V.each(l.defaults,function(e,t){"allowedPreviewTypes"!==e?l[e]=V.extend(!0,{},t,l[e]):void 0===l.allowedPreviewTypes&&(l.allowedPreviewTypes=t)}),l._initPreviewTemplates()},_initPreviewTemplates:function(){var i,a=this,r=a.previewMarkupTags,n=r.tagAfter;V.each(a.previewContentTemplates,function(e,t){K.isEmpty(a.previewTemplates[e])&&(i=r.tagBefore2,"generic"!==e&&"image"!==e&&"html"!==e&&"text"!==e||(i=r.tagBefore1),a._isPdfRendered()&&"pdf"===e&&(i=i.replace("kv-file-content","kv-file-content kv-pdf-rendered")),a.previewTemplates[e]=i+t+n)})},_initPreviewCache:function(){var b=this;b.previewCache={data:{},init:function(){var e=b.initialPreview;0<e.length&&!K.isArray(e)&&(e=e.split(b.initialPreviewDelimiter)),b.previewCache.data={content:e,config:b.initialPreviewConfig,tags:b.initialPreviewThumbTags}},count:function(){return b.previewCache.data&&b.previewCache.data.content?b.previewCache.data.content.length:0},get:function(e,t){var i,a,r,n,o,s,l,d="init_"+e,c=b.previewCache.data,h=c.config[e],p=c.content[e],u=b.previewInitId+"-"+d,f=K.ifSet("previewAsData",h,b.initialPreviewAsData),m=function(e,t,i,a,r,n,o,s,l){return s=" file-preview-initial "+K.SORT_CSS+(s?" "+s:""),b._generatePreviewTemplate(e,t,i,a,r,!1,null,s,n,o,l)};return p?(t=void 0===t||t,r=K.ifSet("type",h,b.initialPreviewFileType||"generic"),o=K.ifSet("filename",h,K.ifSet("caption",h)),s=K.ifSet("filetype",h,r),n=b.previewCache.footer(e,t,h&&h.size||null),l=K.ifSet("frameClass",h),i=f?m(r,p,o,s,u,n,d,l):m("generic",p,o,s,u,n,d,l,r).setTokens({content:c.content[e]}),c.tags.length&&c.tags[e]&&(i=K.replaceTags(i,c.tags[e])),K.isEmpty(h)||K.isEmpty(h.frameAttr)||((a=V(document.createElement("div")).html(i)).find(".file-preview-initial").attr(h.frameAttr),i=a.html(),a.remove()),i):""},add:function(e,t,i,a){var r,n=b.previewCache.data;return K.isArray(e)||(e=e.split(b.initialPreviewDelimiter)),a?(r=n.content.push(e)-1,n.config[r]=t,n.tags[r]=i):(r=e.length-1,n.content=e,n.config=t,n.tags=i),b.previewCache.data=n,r},set:function(e,t,i,a){var r,n=b.previewCache.data;if(e&&e.length&&(K.isArray(e)||(e=e.split(b.initialPreviewDelimiter)),e.filter(function(e){return null!==e}).length)){if(void 0===n.content&&(n.content=[]),void 0===n.config&&(n.config=[]),void 0===n.tags&&(n.tags=[]),a){for(r=0;r<e.length;r++)e[r]&&n.content.push(e[r]);for(r=0;r<t.length;r++)t[r]&&n.config.push(t[r]);for(r=0;r<i.length;r++)i[r]&&n.tags.push(i[r])}else n.content=e,n.config=t,n.tags=i;b.previewCache.data=n}},unset:function(e){var t=b.previewCache.count(),i=b.reversePreviewOrder;if(t){if(1===t)return b.previewCache.data.content=[],b.previewCache.data.config=[],b.previewCache.data.tags=[],b.initialPreview=[],b.initialPreviewConfig=[],void(b.initialPreviewThumbTags=[]);b.previewCache.data.content=K.spliceArray(b.previewCache.data.content,e,i),b.previewCache.data.config=K.spliceArray(b.previewCache.data.config,e,i),b.previewCache.data.tags=K.spliceArray(b.previewCache.data.tags,e,i)}},out:function(){var e,t,i="",a=b.previewCache.count();if(0===a)return{content:"",caption:""};for(e=0;e<a;e++)t=b.previewCache.get(e),i=b.reversePreviewOrder?t+i:i+t;return{content:i,caption:b._getMsgSelected(a)}},footer:function(e,t,i){var a=b.previewCache.data||{};if(K.isEmpty(a.content))return"";(K.isEmpty(a.config)||K.isEmpty(a.config[e]))&&(a.config[e]={}),t=void 0===t||t;var r,n=a.config[e],o=K.ifSet("caption",n),s=K.ifSet("width",n,"auto"),l=K.ifSet("url",n,!1),d=K.ifSet("key",n,null),c=b.fileActionSettings,h=b.initialPreviewShowDelete||!1,p=n.downloadUrl||b.initialPreviewDownloadUrl||"",u=n.filename||n.caption||"",f=!!p,m=K.ifSet("showRemove",n,K.ifSet("showRemove",c,h)),g=K.ifSet("showDownload",n,K.ifSet("showDownload",c,f)),v=K.ifSet("showZoom",n,K.ifSet("showZoom",c,!0)),w=K.ifSet("showDrag",n,K.ifSet("showDrag",c,!0)),_=!1===l&&t;return g=g&&!1!==n.downloadUrl&&!!p,r=b._renderFileActions(!1,g,m,v,w,_,l,d,!0,p,u),b._getLayoutTemplate("footer").setTokens({progress:b._renderThumbProgress(),actions:r,caption:o,size:b._getSize(i),width:s,indicator:""})}},b.previewCache.init()},_isPdfRendered:function(){var e=this.usePdfRenderer;return("function"==typeof e?e():!!e)&&this.pdfRendererUrl},_handler:function(e,t,i){var a=this.namespace,r=t.split(" ").join(a+" ")+a;e&&e.length&&e.off(r).on(r,i)},_log:function(e){var t=this.$element.attr("id");t&&(e='"'+t+'": '+e),e="bootstrap-fileinput: "+e,void 0!==window.console.log?window.console.log(e):window.alert(e)},_validate:function(){var e="file"===this.$element.attr("type");return e||this._log('The input "type" must be set to "file" for initializing the "bootstrap-fileinput" plugin.'),e},_errorsExist:function(){var e;return!!this.$errorContainer.find("li").length||((e=V(document.createElement("div")).html(this.$errorContainer.html())).find(".kv-error-close").remove(),e.find("ul").remove(),!!V.trim(e.text()).length)},_errorHandler:function(e,t){var i=this,a=e.target.error,r=function(e){i._showError(e.replace("{name}",t))};a.code===a.NOT_FOUND_ERR?r(i.msgFileNotFound):a.code===a.SECURITY_ERR?r(i.msgFileSecured):a.code===a.NOT_READABLE_ERR?r(i.msgFileNotReadable):a.code===a.ABORT_ERR?r(i.msgFilePreviewAborted):r(i.msgFilePreviewError)},_addError:function(e){var t=this,i=t.$errorContainer;e&&i.length&&(i.html(t.errorCloseButton+e),t._handler(i.find(".kv-error-close"),"click",function(){setTimeout(function(){t.showPreview&&!t.getFrames().length&&t.clear(),i.fadeOut("slow")},10)}))},_setValidationError:function(e){e=(e?e+" ":"")+"has-error",this.$container.removeClass(e).addClass("has-error"),K.addCss(this.$captionContainer,"is-invalid")},_resetErrors:function(e){var t=this.$errorContainer;this.isError=!1,this.$container.removeClass("has-error"),this.$captionContainer.removeClass("is-invalid"),t.html(""),e?t.fadeOut("slow"):t.hide()},_showFolderError:function(e){var t,i=this.$errorContainer;e&&(this.isAjaxUpload||this._clearFileInput(),t=this.msgFoldersNotAllowed.replace("{n}",e),this._addError(t),this._setValidationError(),i.fadeIn(800),this._raise("filefoldererror",[e,t]))},_showUploadError:function(e,t,i){var a=this.$errorContainer,r=i||"fileuploaderror",n=t&&t.id?'<li data-file-id="'+t.id+'">'+e+"</li>":"<li>"+e+"</li>";return 0===a.find("ul").length?this._addError("<ul>"+n+"</ul>"):a.find("ul").append(n),a.fadeIn(800),this._raise(r,[t,e]),this._setValidationError("file-input-new"),!0},_showError:function(e,t,i){var a=this.$errorContainer,r=i||"fileerror";return(t=t||{}).reader=this.reader,this._addError(e),a.fadeIn(800),this._raise(r,[t,e]),this.isAjaxUpload||this._clearFileInput(),this._setValidationError("file-input-new"),this.$btnUpload.attr("disabled",!0),!0},_noFilesError:function(e){var t=1<this.minFileCount?this.filePlural:this.fileSingle,i=this.msgFilesTooLess.replace("{n}",this.minFileCount).replace("{files}",t),a=this.$errorContainer;this._addError(i),this.isError=!0,this._updateFileDetails(0),a.fadeIn(800),this._raise("fileerror",[e,i]),this._clearFileInput(),this._setValidationError()},_parseError:function(e,t,i,a){var r,n=V.trim(i+""),o=void 0!==t.responseJSON&&void 0!==t.responseJSON.error?t.responseJSON.error:t.responseText;return this.cancelling&&this.msgUploadAborted&&(n=this.msgUploadAborted),this.showAjaxErrorDetails&&o&&(r=(o=V.trim(o.replace(/\n\s*\n/g,"\n"))).length?"<pre>"+o+"</pre>":"",n+=n?r:o),n||(n=this.msgAjaxError.replace("{operation}",e)),this.cancelling=!1,a?"<b>"+a+": </b>"+n:n},_parseFileType:function(e,t){var i,a,r,n=this.allowedPreviewTypes||[];if("application/text-plain"===e)return"text";for(r=0;r<n.length;r++)if(a=n[r],i=(0,this.fileTypeSettings[a])(e,t)?a:"",!K.isEmpty(i))return i;return"other"},_getPreviewIcon:function(e){var i,a=this,r=null;return e&&-1<e.indexOf(".")&&(i=e.split(".").pop(),a.previewFileIconSettings&&(r=a.previewFileIconSettings[i]||a.previewFileIconSettings[i.toLowerCase()]||null),a.previewFileExtSettings&&V.each(a.previewFileExtSettings,function(e,t){a.previewFileIconSettings[e]&&t(i)&&(r=a.previewFileIconSettings[e])})),r},_parseFilePreviewIcon:function(e,t){var i=this._getPreviewIcon(t)||this.previewFileIcon,a=e;return-1<a.indexOf("{previewFileIcon}")&&(a=a.setTokens({previewFileIconClass:this.previewFileIconClass,previewFileIcon:i})),a},_raise:function(e,t){var i=V.Event(e);if(void 0!==t?this.$element.trigger(i,t):this.$element.trigger(i),i.isDefaultPrevented()||!1===i.result)return!1;switch(e){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":case"filesuccessremove":break;default:this.ajaxAborted||(this.ajaxAborted=i.result)}return!0},_listenFullScreen:function(e){var t,i,a=this.$modal;a&&a.length&&(t=a&&a.find(".btn-fullscreen"),i=a&&a.find(".btn-borderless"),t.length&&i.length&&(t.removeClass("active").attr("aria-pressed","false"),i.removeClass("active").attr("aria-pressed","false"),e?t.addClass("active").attr("aria-pressed","true"):i.addClass("active").attr("aria-pressed","true"),a.hasClass("file-zoom-fullscreen")?this._maximizeZoomDialog():e?this._maximizeZoomDialog():i.removeClass("active").attr("aria-pressed","false")))},_listen:function(){var e=this,t=e.$element,i=e.$form,a=e.$container;e._handler(t,"click",function(e){t.hasClass("file-no-browse")&&(t.data("zoneClicked")?t.data("zoneClicked",!1):e.preventDefault())}),e._handler(t,"change",V.proxy(e._change,e)),e.showBrowse&&e._handler(e.$btnFile,"click",V.proxy(e._browse,e)),e._handler(a.find(".fileinput-remove:not([disabled])"),"click",V.proxy(e.clear,e)),e._handler(a.find(".fileinput-cancel"),"click",V.proxy(e.cancel,e)),e._initDragDrop(),e._handler(i,"reset",V.proxy(e.clear,e)),e.isAjaxUpload||e._handler(i,"submit",V.proxy(e._submitForm,e)),e._handler(e.$container.find(".fileinput-upload"),"click",V.proxy(e._uploadClick,e)),e._handler(V(window),"resize",function(){e._listenFullScreen(screen.width===window.innerWidth&&screen.height===window.innerHeight)}),e._handler(V(document),"webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",function(){e._listenFullScreen(K.checkFullScreen())}),e._autoFitContent(),e._initClickable(),e._refreshPreview()},_autoFitContent:function(){var i,e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=this,t=e<400?a.previewSettingsSmall||a.defaults.previewSettingsSmall:a.previewSettings||a.defaults.previewSettings;V.each(t,function(e,t){i=".file-preview-frame .file-preview-"+e,a.$preview.find(i+".kv-preview-data,"+i+" .kv-preview-data").css(t)})},_scanDroppedItems:function(t,i,a){a=a||"";var r,e,n,o=this,s=function(e){o._log("Error scanning dropped files!"),o._log(e)};t.isFile?t.file(function(e){i.push(e)},s):t.isDirectory&&(e=t.createReader(),(n=function(){e.readEntries(function(e){if(e&&0<e.length){for(r=0;r<e.length;r++)o._scanDroppedItems(e[r],i,a+t.name+"/");n()}return null},s)})())},_initDragDrop:function(){var e=this.$dropZone;this.dropZoneEnabled&&this.showPreview&&(this._handler(e,"dragenter dragover",V.proxy(this._zoneDragEnter,this)),this._handler(e,"dragleave",V.proxy(this._zoneDragLeave,this)),this._handler(e,"drop",V.proxy(this._zoneDrop,this)),this._handler(V(document),"dragenter dragover drop",this._zoneDragDropInit))},_zoneDragDropInit:function(e){e.stopPropagation(),e.preventDefault()},_zoneDragEnter:function(e){var t=-1<V.inArray("Files",e.originalEvent.dataTransfer.types);if(this._zoneDragDropInit(e),this.isDisabled||!t)return e.originalEvent.dataTransfer.effectAllowed="none",void(e.originalEvent.dataTransfer.dropEffect="none");K.addCss(this.$dropZone,"file-highlighted")},_zoneDragLeave:function(e){this._zoneDragDropInit(e),this.isDisabled||this.$dropZone.removeClass("file-highlighted")},_zoneDrop:function(e){var t,i=this,a=i.$element,r=e.originalEvent.dataTransfer,n=r.files,o=r.items,s=K.getDragDropFolders(o),l=function(){i.isAjaxUpload?i._change(e,n):(i.changeTriggered=!0,a.get(0).files=n,setTimeout(function(){i.changeTriggered=!1,a.trigger("change"+i.namespace)},10)),i.$dropZone.removeClass("file-highlighted")};if(e.preventDefault(),!i.isDisabled&&!K.isEmpty(n))if(0<s){if(!i.isAjaxUpload)return void i._showFolderError(s);for(n=[],t=0;t<o.length;t++){var d=o[t].webkitGetAsEntry();d&&i._scanDroppedItems(d,n)}setTimeout(function(){l()},500)}else l()},_uploadClick:function(e){var t,i=this.$container.find(".fileinput-upload"),a=!i.hasClass("disabled")&&K.isEmpty(i.attr("disabled"));e&&e.isDefaultPrevented()||(this.isAjaxUpload?(e.preventDefault(),a&&this.upload()):a&&"submit"!==i.attr("type")&&((t=i.closest("form")).length&&t.trigger("submit"),e.preventDefault()))},_submitForm:function(){return this._isFileSelectionValid()&&!this._abort({})},_clearPreview:function(){var t=this.$preview;(this.showUploadedThumbs?this.getFrames(":not(.file-preview-success)"):this.getFrames()).each(function(){var e=V(this);e.remove(),K.cleanZoomCache(t.find("#zoom-"+e.attr("id")))}),this.getFrames().length&&this.showPreview||this._resetUpload(),this._validateDefaultPreview()},_initSortable:function(){var e,r=this,t=r.$preview,i="."+K.SORT_CSS,n=r.reversePreviewOrder;window.KvSortable&&0!==t.find(i).length&&(e={handle:".drag-handle-init",dataIdAttr:"data-preview-id",scroll:!1,draggable:i,onSort:function(e){var t=e.oldIndex,i=e.newIndex,a=0;r.initialPreview=K.moveArray(r.initialPreview,t,i,n),r.initialPreviewConfig=K.moveArray(r.initialPreviewConfig,t,i,n),r.previewCache.init(),r.getFrames(".file-preview-initial").each(function(){V(this).attr("data-fileindex","init_"+a),a++}),r._raise("filesorted",{previewId:V(e.item).attr("id"),oldIndex:t,newIndex:i,stack:r.initialPreviewConfig})}},t.data("kvsortable")&&t.kvsortable("destroy"),V.extend(!0,e,r.fileActionSettings.dragSettings),t.kvsortable(e))},_setPreviewContent:function(e){this.$preview.html(e),this._autoFitContent()},_initPreview:function(e){var t,i=this.initialCaption||"";if(!this.previewCache.count())return this._clearPreview(),void(e?this._setCaption(i):this._initCaption());t=this.previewCache.out(),i=e&&this.initialCaption?this.initialCaption:t.caption,this._setPreviewContent(t.content),this._setInitThumbAttr(),this._setCaption(i),this._initSortable(),K.isEmpty(t.content)||this.$container.removeClass("file-input-new")},_getZoomButton:function(e){var t=this.previewZoomButtonIcons[e],i=this.previewZoomButtonClasses[e],a=' title="'+(this.previewZoomButtonTitles[e]||"")+'" '+("close"===e?' data-dismiss="modal" aria-hidden="true"':"");return"fullscreen"!==e&&"borderless"!==e&&"toggleheader"!==e||(a+=' data-toggle="button" aria-pressed="false" autocomplete="off"'),'<button type="button" class="'+i+" btn-"+e+'"'+a+">"+t+"</button>"},_getModalContent:function(){return this._getLayoutTemplate("modal").setTokens({rtl:this.rtl?" kv-rtl":"",zoomFrameClass:this.frameClass,heading:this.msgZoomModalHeading,prev:this._getZoomButton("prev"),next:this._getZoomButton("next"),toggleheader:this._getZoomButton("toggleheader"),fullscreen:this._getZoomButton("fullscreen"),borderless:this._getZoomButton("borderless"),close:this._getZoomButton("close")})},_listenModalEvent:function(a){var r=this,n=r.$modal;n.on(a+".bs.modal",function(e){var t=n.find(".btn-fullscreen"),i=n.find(".btn-borderless");r._raise("filezoom"+a,{sourceEvent:e,previewId:n.data("previewId"),modal:n}),"shown"===a&&(i.removeClass("active").attr("aria-pressed","false"),t.removeClass("active").attr("aria-pressed","false"),n.hasClass("file-zoom-fullscreen")&&(r._maximizeZoomDialog(),K.checkFullScreen()?t.addClass("active").attr("aria-pressed","true"):i.addClass("active").attr("aria-pressed","true")))})},_initZoom:function(){var e,i=this,t=i._getLayoutTemplate("modalMain"),a="#"+K.MODAL_ID;i.showPreview&&(i.$modal=V(a),i.$modal&&i.$modal.length||(e=V(document.createElement("div")).html(t).insertAfter(i.$container),i.$modal=V(a).insertBefore(e),e.remove()),K.initModal(i.$modal),i.$modal.html(i._getModalContent()),V.each(K.MODAL_EVENTS,function(e,t){i._listenModalEvent(t)}))},_initZoomButtons:function(){var e,t,i=this.$modal.data("previewId")||"",a=this.getFrames().toArray(),r=a.length,n=this.$modal.find(".btn-prev"),o=this.$modal.find(".btn-next");if(a.length<2)return n.hide(),void o.hide();n.show(),o.show(),r&&(e=V(a[0]),t=V(a[r-1]),n.removeAttr("disabled"),o.removeAttr("disabled"),e.length&&e.attr("id")===i&&n.attr("disabled",!0),t.length&&t.attr("id")===i&&o.attr("disabled",!0))},_maximizeZoomDialog:function(){var e=this.$modal,t=e.find(".modal-header:visible"),i=e.find(".modal-footer:visible"),a=e.find(".modal-body"),r=V(window).height();e.addClass("file-zoom-fullscreen"),t&&t.length&&(r-=t.outerHeight(!0)),i&&i.length&&(r-=i.outerHeight(!0)),a&&a.length&&(r-=a.outerHeight(!0)-a.height()),e.find(".kv-zoom-body").height(r)},_resizeZoomDialog:function(e){var t=this.$modal,i=t.find(".btn-fullscreen"),a=t.find(".btn-borderless");if(t.hasClass("file-zoom-fullscreen"))K.toggleFullScreen(!1),e?i.hasClass("active")||(t.removeClass("file-zoom-fullscreen"),this._resizeZoomDialog(!0),a.hasClass("active")&&a.removeClass("active").attr("aria-pressed","false")):i.hasClass("active")?i.removeClass("active").attr("aria-pressed","false"):(t.removeClass("file-zoom-fullscreen"),this.$modal.find(".kv-zoom-body").css("height",this.zoomModalHeight));else{if(!e)return void this._maximizeZoomDialog();K.toggleFullScreen(!0)}t.focus()},_setZoomContent:function(e,t){var i,a,r,n,o,s,l,d,c=this,h=e.attr("id"),p=c.$modal,u=p.find(".btn-prev"),f=p.find(".btn-next"),m=p.find(".btn-fullscreen"),g=p.find(".btn-borderless"),v=p.find(".btn-toggleheader"),w=c.$preview.find("#zoom-"+h);a=w.attr("data-template")||"generic",r=(i=w.find(".kv-file-content")).length?i.html():"",n=(e.data("caption")||"")+" "+(e.data("size")||""),p.find(".kv-zoom-title").attr("title",V("<div/>").html(n).text()).html(n),o=p.find(".kv-zoom-body"),p.removeClass("kv-single-content"),t?(d=o.addClass("file-thumb-loading").clone().insertAfter(o),o.html(r).hide(),d.fadeOut("fast",function(){o.fadeIn("fast",function(){o.removeClass("file-thumb-loading")}),d.remove()})):o.html(r),(l=c.previewZoomSettings[a])&&(s=o.find(".kv-preview-data"),K.addCss(s,"file-zoom-detail"),V.each(l,function(e,t){s.css(e,t),(s.attr("width")&&"width"===e||s.attr("height")&&"height"===e)&&s.removeAttr(e)})),p.data("previewId",h),c._handler(u,"click",function(){c._zoomSlideShow("prev",h)}),c._handler(f,"click",function(){c._zoomSlideShow("next",h)}),c._handler(m,"click",function(){c._resizeZoomDialog(!0)}),c._handler(g,"click",function(){c._resizeZoomDialog(!1)}),c._handler(v,"click",function(){var e,a=p.find(".modal-header"),t=p.find(".modal-body .floating-buttons"),i=a.find(".kv-zoom-actions"),r=function(e){var t=c.$modal.find(".kv-zoom-body"),i=c.zoomModalHeight;p.hasClass("file-zoom-fullscreen")&&(i=t.outerHeight(!0),e||(i-=a.outerHeight(!0))),t.css("height",e?i+e:i)};a.is(":visible")?(e=a.outerHeight(!0),a.slideUp("slow",function(){i.find(".btn").appendTo(t),r(e)})):(t.find(".btn").appendTo(i),a.slideDown("slow",function(){r()})),p.focus()}),c._handler(p,"keydown",function(e){var t=e.which||e.keyCode;37!==t||u.attr("disabled")||c._zoomSlideShow("prev",h),39!==t||f.attr("disabled")||c._zoomSlideShow("next",h)})},_zoomPreview:function(e){var t,i=this.$modal;if(!e.length)throw"Cannot zoom to detailed preview!";K.initModal(i),i.html(this._getModalContent()),t=e.closest(K.FRAMES),this._setZoomContent(t),i.modal("show"),this._initZoomButtons()},_zoomSlideShow:function(e,t){var i,a,r,n=this.$modal.find(".kv-zoom-actions .btn-"+e),o=this.getFrames().toArray(),s=o.length;if(!n.attr("disabled")){for(a=0;a<s;a++)if(V(o[a]).attr("id")===t){r="prev"===e?a-1:a+1;break}r<0||s<=r||!o[r]||((i=V(o[r])).length&&this._setZoomContent(i,!0),this._initZoomButtons(),this._raise("filezoom"+e,{previewId:t,modal:this.$modal}))}},_initZoomButton:function(){var t=this;t.$preview.find(".kv-file-zoom").each(function(){var e=V(this);t._handler(e,"click",function(){t._zoomPreview(e)})})},_inputFileCount:function(){return this.$element.get(0).files.length},_refreshPreview:function(){var e;this._inputFileCount()&&this.showPreview&&this.isPreviewable&&(this.isAjaxUpload?(e=this.getFileStack(),this.filestack=[],e.length?this._clearFileInput():e=this.$element.get(0).files):e=this.$element.get(0).files,e&&e.length&&(this.readFiles(e),this._setFileDropZoneTitle()))},_clearObjects:function(e){e.find("video audio").each(function(){this.pause(),V(this).remove()}),e.find("img object div").each(function(){V(this).remove()})},_clearFileInput:function(){var e,t,i,a=this.$element;this._inputFileCount()&&(e=a.closest("form"),t=V(document.createElement("form")),i=V(document.createElement("div")),a.before(i),e.length?e.after(t):i.after(t),t.append(a).trigger("reset"),i.before(a).remove(),t.remove())},_resetUpload:function(){this.uploadCache={content:[],config:[],tags:[],append:!0},this.uploadCount=0,this.uploadStatus={},this.uploadLog=[],this.uploadAsyncCount=0,this.loadedImages=[],this.totalImagesCount=0,this.$btnUpload.removeAttr("disabled"),this._setProgress(0),this.$progress.hide(),this._resetErrors(!1),this.ajaxAborted=!1,this.ajaxRequests=[],this._resetCanvas(),this.cacheInitialPreview={},this.overwriteInitial&&(this.initialPreview=[],this.initialPreviewConfig=[],this.initialPreviewThumbTags=[],this.previewCache.data={content:[],config:[],tags:[]})},_resetCanvas:function(){this.canvas&&this.imageCanvasContext&&this.imageCanvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)},_hasInitialPreview:function(){return!this.overwriteInitial&&this.previewCache.count()},_resetPreview:function(){var e,t;this.previewCache.count()?(e=this.previewCache.out(),this._setPreviewContent(e.content),this._setInitThumbAttr(),t=this.initialCaption?this.initialCaption:e.caption,this._setCaption(t)):(this._clearPreview(),this._initCaption()),this.showPreview&&(this._initZoom(),this._initSortable())},_clearDefaultPreview:function(){this.$preview.find(".file-default-preview").remove()},_validateDefaultPreview:function(){this.showPreview&&!K.isEmpty(this.defaultPreviewContent)&&(this._setPreviewContent('<div class="file-default-preview">'+this.defaultPreviewContent+"</div>"),this.$container.removeClass("file-input-new"),this._initClickable())},_resetPreviewThumbs:function(e){var t;if(e)return this._clearPreview(),void this.clearStack();this._hasInitialPreview()?(t=this.previewCache.out(),this._setPreviewContent(t.content),this._setInitThumbAttr(),this._setCaption(t.caption),this._initPreviewActions()):this._clearPreview()},_getLayoutTemplate:function(e){var t=this.layoutTemplates[e];return K.isEmpty(this.customLayoutTags)?t:K.replaceTags(t,this.customLayoutTags)},_getPreviewTemplate:function(e){var t=this.previewTemplates[e];return K.isEmpty(this.customPreviewTags)?t:K.replaceTags(t,this.customPreviewTags)},_getOutData:function(e,t,i){return e=e||{},t=t||{},i=i||this.filestack.slice(0)||{},{form:this.formdata,files:i,filenames:this.filenames,filescount:this.getFilesCount(),extra:this._getExtraData(),response:t,reader:this.reader,jqXHR:e}},_getMsgSelected:function(e){var t=1===e?this.fileSingle:this.filePlural;return 0<e?this.msgSelected.replace("{n}",e).replace("{files}",t):this.msgNoFilesSelected},_getFrame:function(e){var t=V("#"+e);return t.length?t:(this._log('Invalid thumb frame with id: "'+e+'".'),null)},_getThumbs:function(e){return e=e||"",this.getFrames(":not(.file-preview-initial)"+e)},_getExtraData:function(e,t){var i=this.uploadExtraData;return"function"==typeof this.uploadExtraData&&(i=this.uploadExtraData(e,t)),i},_initXhr:function(e,r,n){var o=this;return e.upload&&e.upload.addEventListener("progress",function(e){var t=0,i=e.total,a=e.loaded||e.position;e.lengthComputable&&(t=Math.floor(a/i*100)),r?o._setAsyncUploadStatus(r,t,n):o._setProgress(t)},!1),e},_initAjaxSettings:function(){this._ajaxSettings=V.extend(!0,{},this.ajaxSettings),this._ajaxDeleteSettings=V.extend(!0,{},this.ajaxDeleteSettings)},_mergeAjaxCallback:function(e,t,i){var a,r=this._ajaxSettings,n=this.mergeAjaxCallbacks;"delete"===i&&(r=this._ajaxDeleteSettings,n=this.mergeAjaxDeleteCallbacks),a=r[e],r[e]=n&&"function"==typeof a?"before"===n?function(){a.apply(this,arguments),t.apply(this,arguments)}:function(){t.apply(this,arguments),a.apply(this,arguments)}:t},_ajaxSubmit:function(e,t,i,a,r,n){var o,s=this;s._raise("filepreajax",[r,n])&&(s._uploadExtra(r,n),s._initAjaxSettings(),s._mergeAjaxCallback("beforeSend",e),s._mergeAjaxCallback("success",t),s._mergeAjaxCallback("complete",i),s._mergeAjaxCallback("error",a),o=V.extend(!0,{},{xhr:function(){var e=V.ajaxSettings.xhr();return s._initXhr(e,r,s.getFileStack().length)},url:n&&s.uploadUrlThumb?s.uploadUrlThumb:s.uploadUrl,type:"POST",dataType:"json",data:s.formdata,cache:!1,processData:!1,contentType:!1},s._ajaxSettings),s.ajaxRequests.push(V.ajax(o)))},_mergeArray:function(e,t){var i=K.cleanArray(this[e]),a=K.cleanArray(t);this[e]=i.concat(a)},_initUploadSuccess:function(e,t,i){var a,r,n,o,s,l,d,c,h,p=this;p.showPreview&&"object"==_typeof(e)&&!V.isEmptyObject(e)&&void 0!==e.initialPreview&&0<e.initialPreview.length&&(p.hasInitData=!0,l=e.initialPreview||[],d=e.initialPreviewConfig||[],c=e.initialPreviewThumbTags||[],a=void 0===e.append||e.append,0<l.length&&!K.isArray(l)&&(l=l.split(p.initialPreviewDelimiter)),p._mergeArray("initialPreview",l),p._mergeArray("initialPreviewConfig",d),p._mergeArray("initialPreviewThumbTags",c),void 0!==t?i?(h=t.attr("data-fileindex"),p.uploadCache.content[h]=l[0],p.uploadCache.config[h]=d[0]||[],p.uploadCache.tags[h]=c[0]||[],p.uploadCache.append=a):(n=p.previewCache.add(l,d[0],c[0],a),r=p.previewCache.get(n,!1),(s=(o=V(document.createElement("div")).html(r).hide().insertAfter(t)).find(".kv-zoom-cache"))&&s.length&&s.insertAfter(t),t.fadeOut("slow",function(){var e=o.find(".file-preview-frame");e&&e.length&&e.insertBefore(t).fadeIn("slow").css("display:inline-block"),p._initPreviewActions(),p._clearFileInput(),K.cleanZoomCache(p.$preview.find("#zoom-"+t.attr("id"))),t.remove(),o.remove(),p._initSortable()})):(p.previewCache.set(l,d,c,a),p._initPreview(),p._initPreviewActions()))},_initSuccessThumbs:function(){var r=this;r.showPreview&&r._getThumbs(K.FRAMES+".file-preview-success").each(function(){var i=V(this),a=r.$preview,e=i.find(".kv-file-remove");e.removeAttr("disabled"),r._handler(e,"click",function(){var e=i.attr("id"),t=r._raise("filesuccessremove",[e,i.attr("data-fileindex")]);K.cleanMemory(i),!1!==t&&i.fadeOut("slow",function(){K.cleanZoomCache(a.find("#zoom-"+e)),i.remove(),r.getFrames().length||r.reset()})})})},_checkAsyncComplete:function(){var e,t;for(t=0;t<this.filestack.length;t++)if(this.filestack[t]&&(e=this.previewInitId+"-"+t,-1===V.inArray(e,this.uploadLog)))return!1;return this.uploadAsyncCount===this.uploadLog.length},_uploadExtra:function(e,t){var i=this,a=i._getExtraData(e,t);0!==a.length&&V.each(a,function(e,t){i.formdata.append(e,t)})},_uploadSingle:function(n,o){var r,s,e,l,t,d,i,a,c,h,p,u=this,f=u.getFileStack().length,m=new FormData,g=u.previewInitId+"-"+n,v=0<u.filestack.length||!V.isEmptyObject(u.uploadExtraData),w=V("#"+g).find(".file-thumb-progress"),_={id:g,index:n};u.formdata=m,u.showPreview&&(s=V("#"+g+":not(.file-preview-initial)"),l=s.find(".kv-file-upload"),t=s.find(".kv-file-remove"),w.show()),0===f||!v||l&&l.hasClass("disabled")||u._abort(_)||(p=function(e,t){d||u.updateStack(e,void 0),u.uploadLog.push(t),u._checkAsyncComplete()&&(u.fileBatchCompleted=!0)},e=function(){var t,i,a,r=u.uploadCache,n=0,o=u.cacheInitialPreview;u.fileBatchCompleted&&(o&&o.content&&(n=o.content.length),setTimeout(function(){var e=0===u.getFileStack(!0).length;if(u.showPreview){if(u.previewCache.set(r.content,r.config,r.tags,r.append),n){for(i=0;i<r.content.length;i++)a=i+n,o.content[a]=r.content[i],o.config.length&&(o.config[a]=r.config[i]),o.tags.length&&(o.tags[a]=r.tags[i]);u.initialPreview=K.cleanArray(o.content),u.initialPreviewConfig=K.cleanArray(o.config),u.initialPreviewThumbTags=K.cleanArray(o.tags)}else u.initialPreview=r.content,u.initialPreviewConfig=r.config,u.initialPreviewThumbTags=r.tags;u.cacheInitialPreview={},u.hasInitData&&(u._initPreview(),u._initPreviewActions())}u.unlock(e),e&&u._clearFileInput(),t=u.$preview.find(".file-preview-initial"),u.uploadAsync&&t.length&&(K.addCss(t,K.SORT_CSS),u._initSortable()),u._raise("filebatchuploadcomplete",[u.filestack,u._getExtraData()]),u.uploadCount=0,u.uploadStatus={},u.uploadLog=[],u._setProgress(101),u.ajaxAborted=!1},100))},i=function(e){r=u._getOutData(e),u.fileBatchCompleted=!1,o||(u.ajaxAborted=!1),u.showPreview&&(s.hasClass("file-preview-success")||(u._setThumbStatus(s,"Loading"),K.addCss(s,"file-uploading")),l.attr("disabled",!0),t.attr("disabled",!0)),o||u.lock(),u._raise("filepreupload",[r,g,n]),V.extend(!0,_,r),u._abort(_)&&(e.abort(),o||(u._setThumbStatus(s,"New"),s.removeClass("file-uploading"),l.removeAttr("disabled"),t.removeAttr("disabled"),u.unlock()),u._setProgressCancelled())},a=function(e,t,i){var a=u.showPreview&&s.attr("id")?s.attr("id"):g;r=u._getOutData(i,e),V.extend(!0,_,r),setTimeout(function(){K.isEmpty(e)||K.isEmpty(e.error)?(u.showPreview&&(u._setThumbStatus(s,"Success"),l.hide(),u._initUploadSuccess(e,s,o),u._setProgress(101,w)),u._raise("fileuploaded",[r,a,n]),o?p(n,a):u.updateStack(n,void 0)):(d=!0,u._showUploadError(e.error,_),u._setPreviewError(s,n,u.filestack[n],u.retryErrorUploads),u.retryErrorUploads||l.hide(),o&&p(n,a),u._setProgress(101,V("#"+a).find(".file-thumb-progress"),u.msgUploadError))},100)},c=function(){setTimeout(function(){u.showPreview&&(l.removeAttr("disabled"),t.removeAttr("disabled"),s.removeClass("file-uploading")),o?e():(u.unlock(!1),u._clearFileInput()),u._initSuccessThumbs()},100)},h=function(e,t,i){var a=u.ajaxOperations.uploadThumb,r=u._parseError(a,e,i,o&&u.filestack[n].name?u.filestack[n].name:null);d=!0,setTimeout(function(){o&&p(n,g),u.uploadStatus[g]=100,u._setPreviewError(s,n,u.filestack[n],u.retryErrorUploads),u.retryErrorUploads||l.hide(),V.extend(!0,_,u._getOutData(e)),u._setProgress(101,w,u.msgAjaxProgressError.replace("{operation}",a)),u._setProgress(101,V("#"+g).find(".file-thumb-progress"),u.msgUploadError),u._showUploadError(r,_)},100)},m.append(u.uploadFileAttr,u.filestack[n],u.filenames[n]),m.append("file_id",n),u._ajaxSubmit(i,a,c,h,g,n))},_uploadBatch:function(){var e,t,i,a,s,l=this,r=l.filestack,o=r.length,n=0<l.filestack.length||!V.isEmptyObject(l.uploadExtraData);l.formdata=new FormData,0!==o&&n&&!l._abort({})&&(s=function(){V.each(r,function(e){l.updateStack(e,void 0)}),l._clearFileInput()},e=function(e){l.lock();var t=l._getOutData(e);l.ajaxAborted=!1,l.showPreview&&l._getThumbs().each(function(){var e=V(this),t=e.find(".kv-file-upload"),i=e.find(".kv-file-remove");e.hasClass("file-preview-success")||(l._setThumbStatus(e,"Loading"),K.addCss(e,"file-uploading")),t.attr("disabled",!0),i.attr("disabled",!0)}),l._raise("filebatchpreupload",[t]),l._abort(t)&&(e.abort(),l._getThumbs().each(function(){var e=V(this),t=e.find(".kv-file-upload"),i=e.find(".kv-file-remove");e.hasClass("file-preview-loading")&&(l._setThumbStatus(e,"New"),e.removeClass("file-uploading")),t.removeAttr("disabled"),i.removeAttr("disabled")}),l._setProgressCancelled())},t=function(e,t,i){var a=l._getOutData(i,e),r=0,n=l._getThumbs(":not(.file-preview-success)"),o=K.isEmpty(e)||K.isEmpty(e.errorkeys)?[]:e.errorkeys;K.isEmpty(e)||K.isEmpty(e.error)?(l._raise("filebatchuploadsuccess",[a]),s(),l.showPreview?(n.each(function(){var e=V(this);l._setThumbStatus(e,"Success"),e.removeClass("file-uploading"),e.find(".kv-file-upload").hide().removeAttr("disabled")}),l._initUploadSuccess(e)):l.reset(),l._setProgress(101)):(l.showPreview&&(n.each(function(){var e=V(this),t=e.attr("data-fileindex");e.removeClass("file-uploading"),e.find(".kv-file-upload").removeAttr("disabled"),e.find(".kv-file-remove").removeAttr("disabled"),0===o.length||-1!==V.inArray(r,o)?(l._setPreviewError(e,t,l.filestack[t],l.retryErrorUploads),l.retryErrorUploads||(e.find(".kv-file-upload").hide(),l.updateStack(t,void 0))):(e.find(".kv-file-upload").hide(),l._setThumbStatus(e,"Success"),l.updateStack(t,void 0)),e.hasClass("file-preview-error")&&!l.retryErrorUploads||r++}),l._initUploadSuccess(e)),l._showUploadError(e.error,a,"filebatchuploaderror"),l._setProgress(101,l.$progress,l.msgUploadError))},a=function(){l.unlock(),l._initSuccessThumbs(),l._clearFileInput(),l._raise("filebatchuploadcomplete",[l.filestack,l._getExtraData()])},i=function(e,t,i){var a=l._getOutData(e),r=l.ajaxOperations.uploadBatch,n=l._parseError(r,e,i);l._showUploadError(n,a,"filebatchuploaderror"),l.uploadFileCount=o-1,l.showPreview&&(l._getThumbs().each(function(){var e=V(this),t=e.attr("data-fileindex");e.removeClass("file-uploading"),void 0!==l.filestack[t]&&l._setPreviewError(e)}),l._getThumbs().removeClass("file-uploading"),l._getThumbs(" .kv-file-upload").removeAttr("disabled"),l._getThumbs(" .kv-file-delete").removeAttr("disabled"),l._setProgress(101,l.$progress,l.msgAjaxProgressError.replace("{operation}",r)))},V.each(r,function(e,t){K.isEmpty(r[e])||l.formdata.append(l.uploadFileAttr,t,l.filenames[e])}),l._ajaxSubmit(e,t,a,i))},_uploadExtraOnly:function(){var e,t,i,a,o=this,s={};o.formdata=new FormData,o._abort(s)||(e=function(e){o.lock();var t=o._getOutData(e);o._raise("filebatchpreupload",[t]),o._setProgress(50),s.data=t,s.xhr=e,o._abort(s)&&(e.abort(),o._setProgressCancelled())},t=function(e,t,i){var a=o._getOutData(i,e);K.isEmpty(e)||K.isEmpty(e.error)?(o._raise("filebatchuploadsuccess",[a]),o._clearFileInput(),o._initUploadSuccess(e),o._setProgress(101)):o._showUploadError(e.error,a,"filebatchuploaderror")},i=function(){o.unlock(),o._clearFileInput(),o._raise("filebatchuploadcomplete",[o.filestack,o._getExtraData()])},a=function(e,t,i){var a=o._getOutData(e),r=o.ajaxOperations.uploadExtra,n=o._parseError(r,e,i);s.data=a,o._showUploadError(n,a,"filebatchuploaderror"),o._setProgress(101,o.$progress,o.msgAjaxProgressError.replace("{operation}",r))},o._ajaxSubmit(e,t,i,a))},_deleteFileIndex:function(e){var i=e.attr("data-fileindex"),t=this.reversePreviewOrder;"init_"===i.substring(0,5)&&(i=parseInt(i.replace("init_","")),this.initialPreview=K.spliceArray(this.initialPreview,i,t),this.initialPreviewConfig=K.spliceArray(this.initialPreviewConfig,i,t),this.initialPreviewThumbTags=K.spliceArray(this.initialPreviewThumbTags,i,t),this.getFrames().each(function(){var e=V(this),t=e.attr("data-fileindex");"init_"===t.substring(0,5)&&(t=parseInt(t.replace("init_","")))>i&&(t--,e.attr("data-fileindex","init_"+t))}),this.uploadAsync&&(this.cacheInitialPreview=this.getPreview()))},_initFileActions:function(){var c=this,h=c.$preview;c.showPreview&&(c._initZoomButton(),c.getFrames(" .kv-file-remove").each(function(){var r,n,o,e=V(this),s=e.closest(K.FRAMES),l=s.attr("id"),d=s.attr("data-fileindex");c._handler(e,"click",function(){if(!1===c._raise("filepreremove",[l,d])||!c._validateMinCount())return!1;r=s.hasClass("file-preview-error"),K.cleanMemory(s),s.fadeOut("slow",function(){K.cleanZoomCache(h.find("#zoom-"+l)),c.updateStack(d,void 0),c._clearObjects(s),s.remove(),l&&r&&c.$errorContainer.find('li[data-file-id="'+l+'"]').fadeOut("fast",function(){V(this).remove(),c._errorsExist()||c._resetErrors()}),c._clearFileInput();var e=c.getFileStack(!0),t=c.previewCache.count(),i=e.length,a=c.showPreview&&c.getFrames().length;0!==i||0!==t||a?(o=1<(n=t+i)?c._getMsgSelected(n):e[0]?c._getFileNames()[0]:"",c._setCaption(o)):c.reset(),c._raise("fileremoved",[l,d])})})}),c.getFrames(" .kv-file-upload").each(function(){var i=V(this);c._handler(i,"click",function(){var e=i.closest(K.FRAMES),t=e.attr("data-fileindex");c.$progress.hide(),e.hasClass("file-preview-error")&&!c.retryErrorUploads||c._uploadSingle(t,!1)})}))},_initPreviewActions:function(){var u=this,f=u.$preview,m=u.deleteExtraData||{},e=K.FRAMES+" .kv-file-remove",t=u.fileActionSettings,g=t.removeClass,v=t.removeErrorClass,w=function(){var e=u.isAjaxUpload?u.previewCache.count():u._inputFileCount();f.find(K.FRAMES).length||e||(u._setCaption(""),u.reset(),u.initialCaption="")};u._initZoomButton(),f.find(e).each(function(){var e,t,i,n=V(this),a=n.data("url")||u.deleteUrl,o=n.data("key");if(!K.isEmpty(a)&&void 0!==o){var r,s,l,d,c=n.closest(K.FRAMES),h=u.previewCache.data,p=c.attr("data-fileindex");p=parseInt(p.replace("init_","")),l=K.isEmpty(h.config)&&K.isEmpty(h.config[p])?null:h.config[p],"function"==typeof(d=K.isEmpty(l)||K.isEmpty(l.extra)?m:l.extra)&&(d=d()),s={id:n.attr("id"),key:o,extra:d},e=function(e){u.ajaxAborted=!1,u._raise("filepredelete",[o,e,d]),u._abort()?e.abort():(n.removeClass(v),K.addCss(c,"file-uploading"),K.addCss(n,"disabled "+g))},t=function(e,t,i){var a,r;if(!K.isEmpty(e)&&!K.isEmpty(e.error))return s.jqXHR=i,s.response=e,u._showError(e.error,s,"filedeleteerror"),c.removeClass("file-uploading"),n.removeClass("disabled "+g).addClass(v),void w();c.removeClass("file-uploading").addClass("file-deleted"),c.fadeOut("slow",function(){p=parseInt(c.attr("data-fileindex").replace("init_","")),u.previewCache.unset(p),u._deleteFileIndex(c),a=u.previewCache.count(),r=0<a?u._getMsgSelected(a):"",u._setCaption(r),u._raise("filedeleted",[o,i,d]),K.cleanZoomCache(f.find("#zoom-"+c.attr("id"))),u._clearObjects(c),c.remove(),w()})},i=function(e,t,i){var a=u.ajaxOperations.deleteThumb,r=u._parseError(a,e,i);s.jqXHR=e,s.response={},u._showError(r,s,"filedeleteerror"),c.removeClass("file-uploading"),n.removeClass("disabled "+g).addClass(v),w()},u._initAjaxSettings(),u._mergeAjaxCallback("beforeSend",e,"delete"),u._mergeAjaxCallback("success",t,"delete"),u._mergeAjaxCallback("error",i,"delete"),r=V.extend(!0,{},{url:a,type:"POST",dataType:"json",data:V.extend(!0,{},{key:o},d)},u._ajaxDeleteSettings),u._handler(n,"click",function(){if(!u._validateMinCount())return!1;u.ajaxAborted=!1,u._raise("filebeforedelete",[o,d]),u.ajaxAborted instanceof Promise?u.ajaxAborted.then(function(e){e||V.ajax(r)}):u.ajaxAborted||V.ajax(r)})}})},_hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.removeClass("icon-visible")},_showFileIcon:function(){K.addCss(this.$captionContainer,"icon-visible")},_getSize:function(e){var t,i,a,r=parseFloat(e),n=this.fileSizeGetter;return V.isNumeric(e)&&V.isNumeric(r)?(a="function"==typeof n?n(r):0===r?"0.00 B":(t=Math.floor(Math.log(r)/Math.log(1024)),i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],1*(r/Math.pow(1024,t)).toFixed(2)+" "+i[t]),this._getLayoutTemplate("size").replace("{sizeText}",a)):""},_generatePreviewTemplate:function(s,e,l,d,c,t,i,h,a,p,u){var r,f=this,m=f.slug(l),n="",g="",o=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<400?f.previewSettingsSmall[s]||f.defaults.previewSettingsSmall[s]:f.previewSettings[s]||f.defaults.previewSettings[s],v=a||f._renderFileFooter(m,i,"auto",t),w=f._getPreviewIcon(l),_="type-default",b=w&&f.preferIconicPreview,C=w&&f.preferIconicZoomPreview;return o&&V.each(o,function(e,t){g+=e+":"+t+";"}),r=function(e,t,i,a){var r=i?"zoom-"+c:c,n=f._getPreviewTemplate(e),o=(h||"")+" "+a;return f.frameClass&&(o=f.frameClass+" "+o),i&&(o=o.replace(" "+K.SORT_CSS,"")),n=f._parseFilePreviewIcon(n,l),"text"===e&&(t=K.htmlEncode(t)),"object"!==s||d||V.each(f.defaults.fileTypeSettings,function(e,t){"object"!==e&&"other"!==e&&t(l,d)&&(_="type-"+e)}),n.setTokens({previewId:r,caption:m,frameClass:o,type:d,fileindex:p,typeCss:_,footer:v,data:t,template:u||s,style:g?'style="'+g+'"':""})},p=p||c.slice(c.lastIndexOf("-")+1),f.fileActionSettings.showZoom&&(n=r(C?"other":s,e,!0,"kv-zoom-thumb")),n="\n"+f._getLayoutTemplate("zoomCache").replace("{zoomContent}",n),r(b?"other":s,e,!1,"kv-preview-thumb")+n},_addToPreview:function(e,t){return this.reversePreviewOrder?e.prepend(t):e.append(t)},_previewDefault:function(e,t,i){var a=this.$preview;if(this.showPreview){var r,n=e?e.name:"",o=e?e.type:"",s=e.size||0,l=this.slug(n),d=!0===i&&!this.isAjaxUpload,c=K.objUrl.createObjectURL(e);this._clearDefaultPreview(),r=this._generatePreviewTemplate("other",c,n,o,t,d,s),this._addToPreview(a,r),this._setThumbAttr(t,l,s),!0===i&&this.isAjaxUpload&&this._setThumbStatus(V("#"+t),"Error")}},_previewFile:function(e,t,i,a,r,n){if(this.showPreview){var o,s=t?t.name:"",l=n.type,d=n.name,c=this._parseFileType(l,s),h=this.allowedPreviewTypes,p=this.allowedPreviewMimeTypes,u=this.$preview,f=t.size||0,m=h&&0<=h.indexOf(c),g=p&&-1!==p.indexOf(l),v="text"===c||"html"===c||"image"===c?i.target.result:r;if("html"===c&&this.purifyHtml&&window.DOMPurify&&(v=window.DOMPurify.sanitize(v)),m||g){o=this._generatePreviewTemplate(c,v,s,l,a,!1,f),this._clearDefaultPreview(),this._addToPreview(u,o);var w=u.find("#"+a+" img");this._validateImageOrientation(w,t,a,d,l,f,v)}else this._previewDefault(t,a);this._setThumbAttr(a,d,f),this._initSortable()}},_setThumbAttr:function(e,t,i){var a=V("#"+e);a.length&&(i=i&&0<i?this._getSize(i):"",a.data({caption:t,size:i}))},_setInitThumbAttr:function(){var e,t,i,a,r=this.previewCache.data,n=this.previewCache.count();if(0!==n)for(var o=0;o<n;o++)e=r.config[o],a=this.previewInitId+"-init_"+o,t=K.ifSet("caption",e,K.ifSet("filename",e)),i=K.ifSet("size",e),this._setThumbAttr(a,t,i)},_slugDefault:function(e){return K.isEmpty(e)?"":String(e).replace(/[\[\]\/\{}:;#%=\(\)\*\+\?\\\^\$\|<>&"']/g,"_")},_updateFileDetails:function(e){var t=this.$element,i=this.getFileStack(),a=K.isIE(9)&&K.findFileName(t.val())||t[0].files[0]&&t[0].files[0].name||i.length&&i[0].name||"",r=this.slug(a),n=this.isAjaxUpload?i.length:e,o=this.previewCache.count()+n,s=1===n?r:this._getMsgSelected(o);this.isError?(this.$previewContainer.removeClass("file-thumb-loading"),this.$previewStatus.html(""),this.$captionContainer.removeClass("icon-visible")):this._showFileIcon(),this._setCaption(s,this.isError),this.$container.removeClass("file-input-new file-input-ajax-new"),1===arguments.length&&this._raise("fileselect",[e,r]),this.previewCache.count()&&this._initPreviewActions()},_setThumbStatus:function(e,t){if(this.showPreview){var i="indicator"+t,a=i+"Title",r="file-preview-"+t.toLowerCase(),n=e.find(".file-upload-indicator"),o=this.fileActionSettings;e.removeClass("file-preview-success file-preview-error file-preview-loading"),"Success"===t&&e.find(".file-drag-handle").remove(),n.html(o[i]),n.attr("title",o[a]),e.addClass(r),"Error"!==t||this.retryErrorUploads||e.find(".kv-file-upload").attr("disabled",!0)}},_setProgressCancelled:function(){this._setProgress(101,this.$progress,this.msgCancelled)},_setProgress:function(e,t,i){var a,r=Math.min(e,100),n=this.progressUploadThreshold,o=e<=100?this.progressTemplate:this.progressCompleteTemplate,s=r<100?this.progressTemplate:i?this.progressErrorTemplate:o;t=t||this.$progress,K.isEmpty(s)||(a=n&&n<r&&e<=100?s.setTokens({percent:n,status:this.msgUploadThreshold}):s.setTokens({percent:r,status:100<e?this.msgUploadEnd:r+"%"}),t.html(a),i&&t.find('[role="progressbar"]').html(i))},_setFileDropZoneTitle:function(){var e,t=this.$container.find(".file-drop-zone"),i=this.dropZoneTitle;this.isClickable&&(e=K.isEmpty(this.$element.attr("multiple"))?this.fileSingle:this.filePlural,i+=this.dropZoneClickTitle.replace("{files}",e)),t.find("."+this.dropZoneTitleClass).remove(),!this.showPreview||0===t.length||0<this.getFileStack().length||!this.dropZoneEnabled||!this.isAjaxUpload&&this.$element.files||(0===t.find(K.FRAMES).length&&K.isEmpty(this.defaultPreviewContent)&&t.prepend('<div class="'+this.dropZoneTitleClass+'">'+i+"</div>"),this.$container.removeClass("file-input-new"),K.addCss(this.$container,"file-input-ajax-new"))},_setAsyncUploadStatus:function(e,t,i){var a=0;this._setProgress(t,V("#"+e).find(".file-thumb-progress")),this.uploadStatus[e]=t,V.each(this.uploadStatus,function(e,t){a+=t}),this._setProgress(Math.floor(a/i))},_validateMinCount:function(){var e=this.isAjaxUpload?this.getFileStack().length:this._inputFileCount();return!(this.validateInitialCount&&0<this.minFileCount&&this._getFileCount(e-1)<this.minFileCount&&(this._noFilesError({}),1))},_getFileCount:function(e){return this.validateInitialCount&&!this.overwriteInitial&&(e+=this.previewCache.count()),e},_getFileId:function(e){var t,i=this.generateFileId;return"function"==typeof i?i(e,event):e&&(t=String(e.webkitRelativePath||e.fileName||e.name||null))?e.size+"-"+t.replace(/[^0-9a-zA-Z_-]/gim,""):null},_getFileName:function(e){return e&&e.name?this.slug(e.name):void 0},_getFileIds:function(t){return this.fileids.filter(function(e){return t?void 0!==e:null!=e})},_getFileNames:function(t){return this.filenames.filter(function(e){return t?void 0!==e:null!=e})},_setPreviewError:function(e,t,i,a){void 0!==t&&this.updateStack(t,i),this.showPreview&&(!this.removeFromPreviewOnError||a?(this._setThumbStatus(e,"Error"),this._refreshUploadButton(e,a)):e.remove())},_refreshUploadButton:function(e,t){var i=e.find(".kv-file-upload"),a=this.fileActionSettings,r=a.uploadIcon,n=a.uploadTitle;i.length&&(t&&(r=a.uploadRetryIcon,n=a.uploadRetryTitle),i.attr("title",n).html(r))},_checkDimensions:function(e,t,i,a,r,n,o){var s,l,d,c=this[("Small"===t?"min":"max")+"Image"+n];!K.isEmpty(c)&&i.length&&(d=i[0],l="Width"===n?d.naturalWidth||d.width:d.naturalHeight||d.height,("Small"===t?c<=l:l<=c)||(s=this["msgImage"+n+t].setTokens({name:r,size:c}),this._showUploadError(s,o),this._setPreviewError(a,e,null)))},_getExifObj:function(e){var t=null;try{t=window.piexif?window.piexif.load(e):null}catch(e){t=null}return t||this._log("Error loading the piexif.js library."),t},_validateImageOrientation:function(e,t,i,a,r,n,o){var s=this._getExifObj(o),l=null;e.length&&this.autoOrientImage&&s&&(l=s["0th"][piexif.ImageIFD.Orientation]),l&&(K.setImageOrientation(e,this.$preview.find("#zoom-"+i+" img"),l),this._raise("fileimageoriented",{$img:e,file:t})),this._validateImage(i,a,r,n,o,s)},_validateImage:function(e,t,i,a,r,n){var o,s,l=this,d=l.$preview,c=d.find("#"+e),h=c.attr("data-fileindex"),p=c.find("img");t=t||"Untitled",p.one("load",function(){s=c.width(),d.width()<s&&p.css("width","100%"),o={ind:h,id:e},l._checkDimensions(h,"Small",p,c,t,"Width",o),l._checkDimensions(h,"Small",p,c,t,"Height",o),l.resizeImage||(l._checkDimensions(h,"Large",p,c,t,"Width",o),l._checkDimensions(h,"Large",p,c,t,"Height",o)),l._raise("fileimageloaded",[e]),l.loadedImages.push({ind:h,img:p,thumb:c,pid:e,typ:i,siz:a,validated:!1,imgData:r,exifObj:n}),c.data("exif",n),l._validateAllImages()}).one("error",function(){l._raise("fileimageloaderror",[e])}).each(function(){this.complete?V(this).trigger("load"):this.error&&V(this).trigger("error")})},_validateAllImages:function(){var e,t,i,a={val:0},r=this.loadedImages.length,n=this.resizeIfSizeMoreThan;if(r===this.totalImagesCount&&(this._raise("fileimagesloaded"),this.resizeImage))for(e=0;e<this.loadedImages.length;e++)(t=this.loadedImages[e]).validated||((i=t.siz)&&1e3*n<i&&this._getResizedImage(t,a,r),this.loadedImages[e].validated=!0)},_getResizedImage:function(e,t,i){var a,r,n,o,s,l,d=this,c=V(e.img)[0],h=c.naturalWidth,p=c.naturalHeight,u=1,f=d.maxImageWidth||h,m=d.maxImageHeight||p,g=!(!h||!p),v=d.imageCanvas,w=d.imageCanvasContext,_=e.typ,b=e.pid,C=e.ind,y=e.thumb,x=e.exifObj;if(s=function(e,t,i){d.isAjaxUpload?d._showUploadError(e,t,i):d._showError(e,t,i),d._setPreviewError(y,C)},d.filestack[C]&&g&&!(h<=f&&p<=m)||(g&&d.filestack[C]&&d._raise("fileimageresized",[b,C]),t.val++,t.val===i&&d._raise("fileimagesresized"),g)){_=_||d.resizeDefaultImageType,r=f<h,n=m<p,u="width"===d.resizePreference?r?f/h:n?m/p:1:n?m/p:r?f/h:1,d._resetCanvas(),h*=u,p*=u,v.width=h,v.height=p;try{w.drawImage(c,0,0,h,p),o=v.toDataURL(_,d.resizeQuality),x&&(l=window.piexif.dump(x),o=window.piexif.insert(l,o)),a=K.dataURI2Blob(o),d.filestack[C]=a,d._raise("fileimageresized",[b,C]),t.val++,t.val===i&&d._raise("fileimagesresized",[void 0,void 0]),a instanceof Blob||s(d.msgImageResizeError,{id:b,index:C},"fileimageresizeerror")}catch(e){t.val++,t.val===i&&d._raise("fileimagesresized",[void 0,void 0]),s(d.msgImageResizeException.replace("{errors}",e.message),{id:b,index:C},"fileimageresizeexception")}}else s(d.msgImageResizeError,{id:b,index:C},"fileimageresizeerror")},_initBrowse:function(e){var t=this.$element;this.showBrowse?this.$btnFile=e.find(".btn-file").append(t):(t.appendTo(e).attr("tabindex",-1),K.addCss(t,"file-no-browse"))},_initClickable:function(){var i,a=this;a.isClickable&&(i=a.isAjaxUpload?a.$dropZone:a.$preview.find(".file-default-preview"),K.addCss(i,"clickable"),i.attr("tabindex",-1),a._handler(i,"click",function(e){var t=V(e.target);V(a.elErrorContainer+":visible").length||t.parents(".file-preview-thumbnails").length&&!t.parents(".file-default-preview").length||(a.$element.data("zoneClicked",!0).trigger("click"),i.blur())}))},_initCaption:function(){var e=this.initialCaption||"";return this.overwriteInitial||K.isEmpty(e)?(this.$caption.val(""),!1):(this._setCaption(e),!0)},_setCaption:function(e,t){var i,a,r,n,o,s=this.getFileStack();if(this.$caption.length){if(this.$captionContainer.removeClass("icon-visible"),t)i=V("<div>"+this.msgValidationError+"</div>").text(),o=(n=s.length)?1===n&&s[0]?this._getFileNames()[0]:this._getMsgSelected(n):this._getMsgSelected(this.msgNo),a=K.isEmpty(e)?o:e,r='<span class="'+this.msgValidationErrorClass+'">'+this.msgValidationErrorIcon+"</span>";else{if(K.isEmpty(e))return;a=i=V("<div>"+e+"</div>").text(),r=this._getLayoutTemplate("fileIcon")}this.$captionContainer.addClass("icon-visible"),this.$caption.attr("title",i).val(a),this.$captionIcon.html(r)}},_createContainer:function(){var e={class:"file-input file-input-new"+(this.rtl?" kv-rtl":"")},t=V(document.createElement("div")).attr(e).html(this._renderMain());return t.insertBefore(this.$element),this._initBrowse(t),this.theme&&t.addClass("theme-"+this.theme),t},_refreshContainer:function(){var e=this.$container;this.$element.insertAfter(e),e.html(this._renderMain()),this._initBrowse(e),this._validateDisabled()},_validateDisabled:function(){this.$caption.attr({readonly:this.isDisabled})},_renderMain:function(){var e=this.dropZoneEnabled?" file-drop-zone":"file-drop-disabled",t=this.showClose?this._getLayoutTemplate("close"):"",i=this.showPreview?this._getLayoutTemplate("preview").setTokens({class:this.previewClass,dropClass:e}):"",a=this.isDisabled?this.captionClass+" file-caption-disabled":this.captionClass,r=this.captionTemplate.setTokens({class:a+" kv-fileinput-caption"});return this.mainTemplate.setTokens({class:this.mainClass+(!this.showBrowse&&this.showCaption?" no-browse":""),preview:i,close:t,caption:r,upload:this._renderButton("upload"),remove:this._renderButton("remove"),cancel:this._renderButton("cancel"),browse:this._renderButton("browse")})},_renderButton:function(e){var t=this._getLayoutTemplate("btnDefault"),i=this[e+"Class"],a=this[e+"Title"],r=this[e+"Icon"],n=this[e+"Label"],o=this.isDisabled?" disabled":"",s="button";switch(e){case"remove":if(!this.showRemove)return"";break;case"cancel":if(!this.showCancel)return"";i+=" kv-hidden";break;case"upload":if(!this.showUpload)return"";this.isAjaxUpload&&!this.isDisabled?t=this._getLayoutTemplate("btnLink").replace("{href}",this.uploadUrl):s="submit";break;case"browse":if(!this.showBrowse)return"";t=this._getLayoutTemplate("btnBrowse");break;default:return""}return i+="browse"===e?" btn-file":" fileinput-"+e+" fileinput-"+e+"-button",K.isEmpty(n)||(n=' <span class="'+this.buttonLabelClass+'">'+n+"</span>"),t.setTokens({type:s,css:i,title:a,status:o,icon:r,label:n})},_renderThumbProgress:function(){return'<div class="file-thumb-progress kv-hidden">'+this.progressTemplate.setTokens({percent:"0",status:this.msgUploadBegin})+"</div>"},_renderFileFooter:function(e,t,i,a){var r,n=this.fileActionSettings,o=n.showRemove,s=n.showDrag,l=n.showUpload,d=n.showZoom,c=this._getLayoutTemplate("footer"),h=this._getLayoutTemplate("indicator"),p=a?n.indicatorError:n.indicatorNew,u=a?n.indicatorErrorTitle:n.indicatorNewTitle,f=h.setTokens({indicator:p,indicatorTitle:u});return t=this._getSize(t),r=this.isAjaxUpload?c.setTokens({actions:this._renderFileActions(l,!1,o,d,s,!1,!1,!1),caption:e,size:t,width:i,progress:this._renderThumbProgress(),indicator:f}):c.setTokens({actions:this._renderFileActions(!1,!1,!1,d,s,!1,!1,!1),caption:e,size:t,width:i,progress:"",indicator:f}),K.replaceTags(r,this.previewThumbTags)},_renderFileActions:function(e,t,i,a,r,n,o,s,l,d,c){if(!(e||t||i||a||r))return"";var h,p=!1===o?"":' data-url="'+o+'"',u=!1===s?"":' data-key="'+s+'"',f="",m="",g="",v="",w="",_=this._getLayoutTemplate("actions"),b=this.fileActionSettings,C=this.otherActionButtons.setTokens({dataKey:u,key:s}),y=n?b.removeClass+" disabled":b.removeClass;return i&&(f=this._getLayoutTemplate("actionDelete").setTokens({removeClass:y,removeIcon:b.removeIcon,removeTitle:b.removeTitle,dataUrl:p,dataKey:u,key:s})),e&&(m=this._getLayoutTemplate("actionUpload").setTokens({uploadClass:b.uploadClass,uploadIcon:b.uploadIcon,uploadTitle:b.uploadTitle})),t&&(g=(g=this._getLayoutTemplate("actionDownload").setTokens({downloadClass:b.downloadClass,downloadIcon:b.downloadIcon,downloadTitle:b.downloadTitle,downloadUrl:d||this.initialPreviewDownloadUrl})).setTokens({filename:c,key:s})),a&&(v=this._getLayoutTemplate("actionZoom").setTokens({zoomClass:b.zoomClass,zoomIcon:b.zoomIcon,zoomTitle:b.zoomTitle})),r&&l&&(h="drag-handle-init "+b.dragClass,w=this._getLayoutTemplate("actionDrag").setTokens({dragClass:h,dragTitle:b.dragTitle,dragIcon:b.dragIcon})),_.setTokens({delete:f,upload:m,download:g,zoom:v,drag:w,other:C})},_browse:function(e){e&&e.isDefaultPrevented()||!this._raise("filebrowse")||(this.isError&&!this.isAjaxUpload&&this.clear(),this.$captionContainer.focus())},_filterDuplicate:function(e,t,i){var a=this._getFileId(e);a&&i&&-1<i.indexOf(a)||(i||(i=[]),t.push(e),i.push(a))},_change:function(e){var i=this;if(!i.changeTriggered){var t,a,r,n,o,s,l,d,c=i.$element,h=1<arguments.length,p=i.isAjaxUpload,u=[],f=h?arguments[1]:c.get(0).files,m=!p&&K.isEmpty(c.attr("multiple"))?1:i.maxFileCount,g=i.filestack.length,v=K.isEmpty(c.attr("multiple"))&&0<g,w=i._getFileIds();if(i.reader=null,i._resetUpload(),i._hideFileIcon(),i.dropZoneEnabled&&i.$container.find(".file-drop-zone ."+i.dropZoneTitleClass).remove(),p?V.each(f,function(e,t){i._filterDuplicate(t,u,w)}):(f=e.target&&void 0===e.target.files?e.target.value?[{name:e.target.value.replace(/^.+\\/,"")}]:[]:e.target.files||{},u=f),K.isEmpty(u)||0===u.length)return p||i.clear(),void i._raise("fileselectnone");if(i._resetErrors(),a=u.length,t=i._getFileCount(p?i.getFileStack().length+a:a),0<m&&m<t){if(!i.autoReplace||m<a)return r=i.autoReplace&&m<a?a:t,n=m,d=i.msgFilesTooMany.replace("{m}",n).replace("{n}",r),i.isError=(o=d,null,s=V.extend(!0,{},i._getOutData({},{},f),{id:null,index:null}),l={id:null,index:null,file:null,files:f},p?i._showUploadError(o,s):i._showError(o,l)),i.$captionContainer.removeClass("icon-visible"),i._setCaption("",!0),void i.$container.removeClass("file-input-new file-input-ajax-new");m<t&&i._resetPreviewThumbs(p)}else!p||v?(i._resetPreviewThumbs(!1),v&&i.clearStack()):!p||0!==g||i.previewCache.count()&&!i.overwriteInitial||i._resetPreviewThumbs(!0);i.isPreviewable?i.readFiles(u):i._updateFileDetails(1)}},_abort:function(e){var t;return this.ajaxAborted&&"object"==_typeof(this.ajaxAborted)&&void 0!==this.ajaxAborted.message?((t=V.extend(!0,{},this._getOutData(),e)).abortData=this.ajaxAborted.data||{},t.abortMessage=this.ajaxAborted.message,this._setProgress(101,this.$progress,this.msgCancelled),this._showUploadError(this.ajaxAborted.message,t,"filecustomerror"),this.cancel(),!0):!!this.ajaxAborted},_resetFileStack:function(){var r=this,n=0,o=[],s=[],l=[];r._getThumbs().each(function(){var e=V(this),t=e.attr("data-fileindex"),i=r.filestack[t],a=e.attr("id");"-1"!==t&&-1!==t&&(void 0!==i?(o[n]=i,s[n]=r._getFileName(i),l[n]=r._getFileId(i),e.attr({id:r.previewInitId+"-"+n,"data-fileindex":n}),n++):e.attr({id:"uploaded-"+K.uniqId(),"data-fileindex":"-1"}),r.$preview.find("#zoom-"+a).attr({id:"zoom-"+e.attr("id"),"data-fileindex":e.attr("data-fileindex")}))}),r.filestack=o,r.filenames=s,r.fileids=l},_isFileSelectionValid:function(e){return e=e||0,this.required&&!this.getFilesCount()?(this.$errorContainer.html(""),this._showUploadError(this.msgFileRequired),!1):!(0<this.minFileCount&&this._getFileCount(e)<this.minFileCount&&(this._noFilesError({}),1))},clearStack:function(){return this.filestack=[],this.filenames=[],this.fileids=[],this.$element},updateStack:function(e,t){return this.filestack[e]=t,this.filenames[e]=this._getFileName(t),this.fileids[e]=t&&this._getFileId(t)||null,this.$element},addToStack:function(e){return this.filestack.push(e),this.filenames.push(this._getFileName(e)),this.fileids.push(this._getFileId(e)),this.$element},getFileStack:function(t){return this.filestack.filter(function(e){return t?void 0!==e:null!=e})},getFilesCount:function(){var e=this.isAjaxUpload?this.getFileStack().length:this._inputFileCount();return this._getFileCount(e)},readFiles:function(S){this.reader=new FileReader;var k,F=this,P=F.$element,I=F.$preview,A=F.reader,D=F.$previewContainer,z=F.$previewStatus,$=F.msgLoading,j=F.msgProgress,U=F.previewInitId,B=S.length,R=F.fileTypeSettings,O=F.filestack.length,L=F.allowedFileTypes,M=L?L.length:0,Z=F.allowedFileExtensions,N=K.isEmpty(Z)?"":Z.join(", "),H=F.maxFilePreviewSize&&parseFloat(F.maxFilePreviewSize),W=I.length&&(!H||isNaN(H)),q=function(e,t,i,a){var r,n=V.extend(!0,{},F._getOutData({},{},S),{id:i,index:a}),o={id:i,index:a,file:t,files:S};F._previewDefault(t,i,!0),F.isAjaxUpload?(F.addToStack(void 0),setTimeout(function(){k(a+1)},100)):B=0,F._initFileActions(),(r=V("#"+i)).find(".kv-file-upload").hide(),F.removeFromPreviewOnError&&r.remove(),F.isError=F.isAjaxUpload?F._showUploadError(e,n):F._showError(e,o),F._updateFileDetails(B)};F.loadedImages=[],F.totalImagesCount=0,V.each(S,function(e,t){var i=F.fileTypeSettings.image;i&&i(t.type)&&F.totalImagesCount++}),(k=function(c){if(K.isEmpty(P.attr("multiple"))&&(B=1),B<=c)return F.isAjaxUpload&&0<F.filestack.length?F._raise("filebatchselected",[F.getFileStack()]):F._raise("filebatchselected",[S]),D.removeClass("file-thumb-loading"),void z.html("");var e,h,a,t,i,r,n,o,p,u,f,m,g=U+"-"+(O+c),v=S[c],w=R.text,_=R.image,b=R.html,C=v&&v.name?F.slug(v.name):"",s=(v&&v.size||0)/1e3,l="",y=v?K.objUrl.createObjectURL(v):null,d=0,x="",T=0,E=function(){var e=j.setTokens({index:c+1,files:B,percent:50,name:C});setTimeout(function(){z.html(e),F._updateFileDetails(B),k(c+1)},100),F._raise("fileloaded",[v,g,c,A])};if(v){if(0<M)for(h=0;h<M;h++)r=L[h],n=F.msgFileTypes[r]||r,x+=0===h?n:", "+n;if(!1!==C){if(0===C.length)return a=F.msgInvalidFileName.replace("{name}",K.htmlEncode(v.name,"[unknown]")),void q(a,v,g,c);if(K.isEmpty(Z)||(l=new RegExp("\\.("+Z.join("|")+")$","i")),e=s.toFixed(2),0<F.maxFileSize&&s>F.maxFileSize)return a=F.msgSizeTooLarge.setTokens({name:C,size:e,maxSize:F.maxFileSize}),void q(a,v,g,c);if(null!==F.minFileSize&&s<=K.getNum(F.minFileSize))return a=F.msgSizeTooSmall.setTokens({name:C,size:e,minSize:F.minFileSize}),void q(a,v,g,c);if(!K.isEmpty(L)&&K.isArray(L)){for(h=0;h<L.length;h+=1)t=L[h],d+=(o=R[t])&&"function"==typeof o&&o(v.type,v.name)?1:0;if(0===d)return a=F.msgInvalidFileType.setTokens({name:C,types:x}),void q(a,v,g,c)}if(0===d&&!K.isEmpty(Z)&&K.isArray(Z)&&!K.isEmpty(l)&&(i=K.compare(C,l),0===(d+=K.isEmpty(i)?0:i.length)))return a=F.msgInvalidFileExtension.setTokens({name:C,extensions:N}),void q(a,v,g,c);if(!F.showPreview)return F.isAjaxUpload&&F.addToStack(v),setTimeout(function(){k(c+1),F._updateFileDetails(B)},100),void F._raise("fileloaded",[v,g,c,A]);if(!W&&H<s)return F.addToStack(v),D.addClass("file-thumb-loading"),F._previewDefault(v,g),F._initFileActions(),F._updateFileDetails(B),void k(c+1);I.length&&void 0!==FileReader?(p=w(v.type,C),u=b(v.type,C),f=_(v.type,C),z.html($.replace("{index}",c+1).replace("{files}",B)),D.addClass("file-thumb-loading"),A.onerror=function(e){F._errorHandler(e,C)},A.onload=function(e){var t,i,a,r,n,o,s,l,d=[];if(i={name:C,type:v.type},V.each(R,function(e,t){"object"!==e&&"other"!==e&&t(v.type,C)&&T++}),0===T){for(a=new Uint8Array(e.target.result),h=0;h<a.length;h++)r=a[h].toString(16),d.push(r);if(t=d.join("").toLowerCase().substring(0,8),o=K.getMimeType(t,"",""),K.isEmpty(o)&&(n=K.arrayBuffer2String(A.result),o=K.isSvg(n)?"image/svg+xml":K.getMimeType(t,n,v.type)),i={name:C,type:o},p=w(o,""),u=b(o,""),f=_(o,""),(m=p||u)||f)return s=m,(l=new FileReader).onerror=function(e){F._errorHandler(e,C)},l.onload=function(e){F._previewFile(c,v,e,g,y,i),F._initFileActions(),E()},void(s?l.readAsText(v,F.textEncoding):l.readAsDataURL(v))}F._previewFile(c,v,e,g,y,i),F._initFileActions(),E()},A.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100,i=Math.ceil(t);a=j.setTokens({index:c+1,files:B,percent:i,name:C}),setTimeout(function(){z.html(a)},100)}},p||u?A.readAsText(v,F.textEncoding):f?A.readAsDataURL(v):A.readAsArrayBuffer(v)):(F._previewDefault(v,g),setTimeout(function(){k(c+1),F._updateFileDetails(B)},100),F._raise("fileloaded",[v,g,c,A])),F.addToStack(v)}else k(c+1)}})(0),F._updateFileDetails(B,!1)},lock:function(){return this._resetErrors(),this.disable(),this.showRemove&&this.$container.find(".fileinput-remove").hide(),this.showCancel&&this.$container.find(".fileinput-cancel").show(),this._raise("filelock",[this.filestack,this._getExtraData()]),this.$element},unlock:function(e){return void 0===e&&(e=!0),this.enable(),this.showCancel&&this.$container.find(".fileinput-cancel").hide(),this.showRemove&&this.$container.find(".fileinput-remove").show(),e&&this._resetFileStack(),this._raise("fileunlock",[this.filestack,this._getExtraData()]),this.$element},cancel:function(){var e,i=this,t=i.ajaxRequests,a=t.length;if(0<a)for(e=0;e<a;e+=1)i.cancelling=!0,t[e].abort();return i._setProgressCancelled(),i._getThumbs().each(function(){var e=V(this),t=e.attr("data-fileindex");e.removeClass("file-uploading"),void 0!==i.filestack[t]&&(e.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),e.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")),i.unlock()}),i.$element},clear:function(){var e,t=this;if(t._raise("fileclear"))return t.$btnUpload.removeAttr("disabled"),t._getThumbs().find("video,audio,img").each(function(){K.cleanMemory(V(this))}),t._clearFileInput(),t._resetUpload(),t.clearStack(),t._resetErrors(!0),t._hasInitialPreview()?(t._showFileIcon(),t._resetPreview(),t._initPreviewActions(),t.$container.removeClass("file-input-new")):(t._getThumbs().each(function(){t._clearObjects(V(this))}),t.isAjaxUpload&&(t.previewCache.data={}),t.$preview.html(""),e=!t.overwriteInitial&&0<t.initialCaption.length?t.initialCaption:"",t.$caption.attr("title","").val(e),K.addCss(t.$container,"file-input-new"),t._validateDefaultPreview()),0===t.$container.find(K.FRAMES).length&&(t._initCaption()||t.$captionContainer.removeClass("icon-visible")),t._hideFileIcon(),t._raise("filecleared"),t.$captionContainer.focus(),t._setFileDropZoneTitle(),t.$element},reset:function(){if(this._raise("filereset"))return this._resetPreview(),this.$container.find(".fileinput-filename").text(""),K.addCss(this.$container,"file-input-new"),(this.getFrames().length||this.dropZoneEnabled)&&this.$container.removeClass("file-input-new"),this.clearStack(),this.formdata={},this._setFileDropZoneTitle(),this.$element},disable:function(){return this.isDisabled=!0,this._raise("filedisabled"),this.$element.attr("disabled","disabled"),this.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled"),this.$container.find(".fileinput-remove, .fileinput-upload, .file-preview-frame button").attr("disabled",!0),K.addCss(this.$container.find(".btn-file"),"disabled"),this._initDragDrop(),this.$element},enable:function(){return this.isDisabled=!1,this._raise("fileenabled"),this.$element.removeAttr("disabled"),this.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled"),this.$container.find(".fileinput-remove, .fileinput-upload, .file-preview-frame button").removeAttr("disabled"),this.$container.find(".btn-file").removeClass("disabled"),this._initDragDrop(),this.$element},upload:function(){var e,t,i,a=this.getFileStack().length,r=!V.isEmptyObject(this._getExtraData());if(this.isAjaxUpload&&!this.isDisabled&&this._isFileSelectionValid(a))if(this._resetUpload(),0!==a||r)if(this.$progress.show(),this.uploadCount=0,this.uploadStatus={},this.uploadLog=[],this.lock(),this._setProgress(2),0===a&&r)this._uploadExtraOnly();else{if(i=this.filestack.length,this.hasInitData=!1,!this.uploadAsync)return this._uploadBatch(),this.$element;for(t=this._getOutData(),this._raise("filebatchpreupload",[t]),this.fileBatchCompleted=!1,this.uploadCache={content:[],config:[],tags:[],append:!0},this.uploadAsyncCount=this.getFileStack().length,e=0;e<i;e++)this.uploadCache.content[e]=null,this.uploadCache.config[e]=null,this.uploadCache.tags[e]=null;for(this.$preview.find(".file-preview-initial").removeClass(K.SORT_CSS),this._initSortable(),this.cacheInitialPreview=this.getPreview(),e=0;e<i;e++)this.filestack[e]&&this._uploadSingle(e,!0)}else this._showUploadError(this.msgUploadEmpty)},destroy:function(){var e=this.$form,t=this.$container,i=this.$element,a=this.namespace;return V(document).off(a),V(window).off(a),e&&e.length&&e.off(a),this.isAjaxUpload&&this._clearFileInput(),this._cleanup(),this._initPreviewCache(),i.insertBefore(t).off(a).removeData(),t.off().remove(),i},refresh:function(e){var t=this.$element;return e="object"!=_typeof(e)||K.isEmpty(e)?this.options:V.extend(!0,{},this.options,e),this._init(e,!0),this._listen(),t},zoom:function(e){var t=this._getFrame(e),i=this.$modal;t&&(K.initModal(i),i.html(this._getModalContent()),this._setZoomContent(t),i.modal("show"),this._initZoomButtons())},getExif:function(e){var t=this._getFrame(e);return t&&t.data("exif")||null},getFrames:function(e){var t;return e=e||"",t=this.$preview.find(K.FRAMES+e),this.reversePreviewOrder&&(t=V(t.get().reverse())),t},getPreview:function(){return{content:this.initialPreview,config:this.initialPreviewConfig,tags:this.initialPreviewThumbTags}}},V.fn.fileinput=function(l){if(K.hasFileAPISupport()||K.isIE(9)){var d=Array.apply(null,arguments),c=[];switch(d.shift(),this.each(function(){var e,t=V(this),i=t.data("fileinput"),a="object"==_typeof(l)&&l,r=a.theme||t.data("theme"),n={},o={},s=a.language||t.data("language")||V.fn.fileinput.defaults.language||"en";i||(r&&(o=V.fn.fileinputThemes[r]||{}),"en"===s||K.isEmpty(V.fn.fileinputLocales[s])||(n=V.fn.fileinputLocales[s]||{}),e=V.extend(!0,{},V.fn.fileinput.defaults,o,V.fn.fileinputLocales.en,n,a,t.data()),i=new h(this,e),t.data("fileinput",i)),"string"==typeof l&&c.push(i[l].apply(i,d))}),c.length){case 0:return this;case 1:return c[0];default:return c}}},V.fn.fileinput.defaults={language:"en",showCaption:!0,showBrowse:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,showClose:!0,showUploadedThumbs:!0,browseOnZoneClick:!1,autoReplace:!1,autoOrientImage:!1,required:!1,rtl:!1,hideThumbnailContent:!1,generateFileId:null,previewClass:"",captionClass:"",frameClass:"krajee-default",mainClass:"file-caption-main",mainTemplate:null,purifyHtml:!0,fileSizeGetter:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewAsData:!1,initialPreviewFileType:"image",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,initialPreviewDownloadUrl:"",removeFromPreviewOnError:!1,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,previewZoomButtonIcons:{prev:'<i class="glyphicon glyphicon-triangle-left"></i>',next:'<i class="glyphicon glyphicon-triangle-right"></i>',toggleheader:'<i class="glyphicon glyphicon-resize-vertical"></i>',fullscreen:'<i class="glyphicon glyphicon-fullscreen"></i>',borderless:'<i class="glyphicon glyphicon-resize-full"></i>',close:'<i class="glyphicon glyphicon-remove"></i>'},previewZoomButtonClasses:{prev:"btn btn-navigate",next:"btn btn-navigate",toggleheader:"btn btn-sm btn-kv btn-default btn-outline-secondary",fullscreen:"btn btn-sm btn-kv btn-default btn-outline-secondary",borderless:"btn btn-sm btn-kv btn-default btn-outline-secondary",close:"btn btn-sm btn-kv btn-default btn-outline-secondary"},previewTemplates:{},previewContentTemplates:{},preferIconicPreview:!1,preferIconicZoomPreview:!1,allowedPreviewTypes:void 0,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,defaultPreviewContent:null,customLayoutTags:{},customPreviewTags:{},previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',previewFileIconClass:"file-other-icon",previewFileIconSettings:{},previewFileExtSettings:{},buttonLabelClass:"hidden-xs",browseIcon:'<i class="glyphicon glyphicon-folder-open"></i>&nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:"btn btn-default btn-secondary",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i>',cancelClass:"btn btn-default btn-secondary",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-default btn-secondary",uploadUrl:null,uploadUrlThumb:null,uploadAsync:!0,uploadExtraData:{},zoomModalHeight:480,minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,resizeImage:!1,resizePreference:"width",resizeQuality:.92,resizeDefaultImageType:"image/jpeg",resizeIfSizeMoreThan:0,minFileSize:0,maxFileSize:0,maxFilePreviewSize:25600,minFileCount:0,maxFileCount:0,validateInitialCount:!1,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",progressThumbClass:"progress-bar bg-success progress-bar-success progress-bar-striped active",progressClass:"progress-bar bg-success progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar bg-success progress-bar-success",progressErrorClass:"progress-bar bg-danger progress-bar-danger",progressUploadThreshold:99,previewFileType:"image",elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,errorCloseButton:K.closeButton("kv-error-close"),slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0,mergeAjaxCallbacks:!1,mergeAjaxDeleteCallbacks:!1,retryErrorUploads:!0,reversePreviewOrder:!1},V.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgNo:"No",msgNoFilesSelected:"No files selected",msgCancelled:"Cancelled",msgPlaceholder:"Select {files}...",msgZoomModalHeading:"Detailed Preview",msgFileRequired:"You must select a file to upload.",msgSizeTooSmall:'File "{name}" (<b>{size} KB</b>) is too small and must be larger than <b>{minSize} KB</b>.',msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>.',msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload.",msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>.",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileName:'Invalid or unsupported characters in file name "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgFileTypes:{image:"image",html:"HTML",text:"text",video:"video",audio:"audio",flash:"flash",pdf:"PDF",object:"object"},msgUploadAborted:"The file upload was aborted",msgUploadThreshold:"Processing...",msgUploadBegin:"Initializing...",msgUploadEnd:"Done",msgUploadEmpty:"No valid data available for upload.",msgUploadError:"Error",msgValidationError:"Validation Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",msgImageWidthSmall:'Width of image file "{name}" must be at least {size} px.',msgImageHeightSmall:'Height of image file "{name}" must be at least {size} px.',msgImageWidthLarge:'Width of image file "{name}" cannot exceed {size} px.',msgImageHeightLarge:'Height of image file "{name}" cannot exceed {size} px.',msgImageResizeError:"Could not get the image dimensions to resize.",msgImageResizeException:"Error while resizing the image.<pre>{errors}</pre>",msgAjaxError:"Something went wrong with the {operation} operation. Please try again later!",msgAjaxProgressError:"{operation} failed",ajaxOperations:{deleteThumb:"file delete",uploadThumb:"file upload",uploadBatch:"batch file upload",uploadExtra:"form data upload"},dropZoneTitle:"Drag & drop files here &hellip;",dropZoneClickTitle:"<br>(or click to select {files})",previewZoomButtonTitles:{prev:"View previous file",next:"View next file",toggleheader:"Toggle header",fullscreen:"Toggle full screen",borderless:"Toggle borderless mode",close:"Close detailed preview"},usePdfRenderer:function(){return!!navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/i)},pdfRendererUrl:"",pdfRendererTemplate:'<iframe class="kv-preview-data file-preview-pdf" src="{renderer}?file={data}" {style}></iframe>'},V.fn.fileinput.Constructor=h,V(document).ready(function(){var e=V("input.file[type=file]");e.length&&e.fileinput()})});